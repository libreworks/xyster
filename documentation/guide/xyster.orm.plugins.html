<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>9.10. Plugins</title>
<link rel="stylesheet" href="dbstyle.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.72.0">
<link rel="start" href="index.html" title="Programmer's Reference Guide">
<link rel="up" href="xyster.orm.html" title="Chapter 9. Xyster_Orm">
<link rel="prev" href="xyster.orm.queries.html" title="9.9. Queries and Reporting">
<link rel="next" href="xyster.type.html" title="Chapter 10. Xyster_Type">
<link rel="chapter" href="introduction.html" title="Chapter 1. Introduction to Xyster Framework">
<link rel="chapter" href="xyster.acl.html" title="Chapter 2. Xyster_Acl">
<link rel="chapter" href="xyster.collection.html" title="Chapter 3. Xyster_Collection">
<link rel="chapter" href="xyster.controller.html" title="Chapter 4. Xyster_Controller">
<link rel="chapter" href="xyster.data.html" title="Chapter 5. Xyster_Data">
<link rel="chapter" href="xyster.date.html" title="Chapter 6. Xyster_Date">
<link rel="chapter" href="xyster.enum.html" title="Chapter 7. Xyster_Enum">
<link rel="chapter" href="xyster.filter.html" title="Chapter 8. Xyster_Filter">
<link rel="chapter" href="xyster.orm.html" title="Chapter 9. Xyster_Orm">
<link rel="chapter" href="xyster.type.html" title="Chapter 10. Xyster_Type">
<link rel="chapter" href="xyster.validate.html" title="Chapter 11. Xyster_Validate">
<link rel="subsection" href="xyster.orm.plugins.html#xyster.orm.plugins.included" title="9.10.1. Plugins Included in the Release">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader"><table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">9.10. Plugins</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="xyster.orm.queries.html">Prev</a> </td>
<th width="60%" align="center">Chapter 9. Xyster_Orm</th>
<td width="20%" align="right"> <a accesskey="n" href="xyster.type.html">Next</a>
</td>
</tr>
</table></div>
<div class="sect1" lang="en">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="xyster.orm.plugins"></a>9.10. Plugins</h2></div></div></div>
<p>Plugins can be added to the ORM layer through the <code class="classname">Xyster_Orm</code> instance which holds a plugin broker.</p>
<pre class="programlisting">&lt;?php
$plugin = new MyOrmPlugin;
Xyster_Orm::getInstance()-&gt;registerPlugin($plugin);</pre>
<p>There are other plugin-related methods available on <code class="classname">Xyster_Orm</code>.</p>
<div class="itemizedlist"><ul type="disc">
<li><p><code class="methodname">getPlugin</code> : Gets the plugin of the specified type found or an array if more than one are registered</p></li>
<li><p><code class="methodname">getPlugins</code> : Gets all registered plugins</p></li>
<li><p><code class="methodname">hasPlugin</code> : Checks if a plugin of a certain class type has been registered</p></li>
<li><p><code class="methodname">unregisterPlugin</code> : Removes the plugin specified or all plugins of the type specified</p></li>
</ul></div>
<p>The methods of these plugins are called before and after certain events that occur to entities.</p>
<div class="itemizedlist"><ul type="disc">
<li><p><code class="methodname">preDelete</code>: Before an entity is deleted</p></li>
<li><p><code class="methodname">preInsert</code>: Before an entity is newly inserted into the data store</p></li>
<li><p><code class="methodname">preUpdate</code>: Before an entity's changes are saved back to the data store</p></li>
<li><p><code class="methodname">postDelete</code>: After an entity was deleted from the data store</p></li>
<li><p><code class="methodname">postInsert</code>: After an entity is newly inserted into the data store</p></li>
<li><p><code class="methodname">postLoad</code>: When an entity is created from a row in the data store (or retrieved from the secondary cache)</p></li>
<li><p><code class="methodname">postUpdate</code>: After an entity's values were updated in the data store</p></li>
</ul></div>
<div class="sect2" lang="en">
<div class="titlepage"><div><div><h3 class="title">
<a name="xyster.orm.plugins.included"></a>9.10.1. Plugins Included in the Release</h3></div></div></div>
<p>Xyster includes a plugin for ACL registration and one for audit trail logging in its default distribution.</p>
<div class="sect3" lang="en">
<div class="titlepage"><div><div><h4 class="title">
<a name="xyster.orm.plugins.acl"></a>9.10.1.1. Xyster_Orm_Plugin_Acl</h4></div></div></div>
<p>The first plugin included in the framework release is the <code class="classname">Xyster_Orm_Plugin_Acl</code>; responsible for registering entities that implement <span class="interface">Zend_Acl_Resource_Interface</span> in a <code class="classname">Zend_Acl</code>.</p>
<pre class="programlisting">&lt;?php
$acl = new Xyster_Acl;
$plugin = new Xyster_Orm_Plugin_Acl($acl);
Xyster_Orm::getInstance()-&gt;registerPlugin($plugin);</pre>
<p>When an entity is loaded from the data store or pulled from the secondary cache, the ACL plugin adds it to the <code class="classname">Zend_Acl</code> provided to it if the entity has not already been added.  Using this plugin lets the developer omit checking the ACL for the presence of an entity and adding it if absent.</p>
</div>
<div class="sect3" lang="en">
<div class="titlepage"><div><div><h4 class="title">
<a name="xyster.orm.plugins.log"></a>9.10.1.2. Xyster_Orm_Plugin_Log</h4></div></div></div>
<p>The second plugin included in the framework release is the <code class="classname">Xyster_Orm_Plugin_Log</code>; responsible for writing entity events to an audit trail.</p>
<pre class="programlisting">&lt;?php
$log = new Zend_Log(/* with your options here */);
$useAuth = true; /* whether to ask Zend_Auth who is authenticated */
$plugin = new Xyster_Orm_Plugin_Log($log, $useAuth);
Xyster_Orm::getInstance()-&gt;registerPlugin($plugin);</pre>
<p>When an entity is deleted, inserted, or updated, the plugin sends an entry to the <code class="classname">Zend_Log</code> at the information level (<code class="code">Zend_Log::INFO</code>).  As demonstrated above, the plugin can optionally get the current authenticated identity from <code class="classname">Zend_Auth</code>.  This plugin is useful for keeping security records of entity change events.</p>
</div>
</div>
</div>
<div class="navfooter"><table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="xyster.orm.queries.html">Prev</a> </td>
<td width="20%" align="center"><a accesskey="u" href="xyster.orm.html">Up</a></td>
<td width="40%" align="right"> <a accesskey="n" href="xyster.type.html">Next</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">9.9. Queries and Reporting </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top"> Chapter 10. Xyster_Type</td>
</tr>
</table></div>
<div class="revinfo"></div>
</body>
</html>
