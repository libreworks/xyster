<HTML>
<HEAD>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<LINK REL="stylesheet" TYPE="text/css" TITLE="Style" href="../stylesheet.css">
</HEAD>
<BODY>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td class="bannercell" rowspan="2"><a href="http://phing.info/"><img src="http://phing.info/images/phing.gif" alt="http://phing.info/" align="left" border="0"></a></td>
<td style="text-align:right"><h2>Source Code Coverage</h2></td>
</tr>
<tr><td style="text-align:right">Designed for use with <a href="http://pear.php.net/package/PHPUnit2">PHPUnit2</a>, <a href="http://www.xdebug.org/">Xdebug</a> and <a href="http://phing.info/">Phing</a>.</td></tr>
</table>
<hr size="1">
<table class="log" cellpadding="5" cellspacing="0" width="100%"><tr class="a">
<td class="small">Methods: 24</td>
<td class="small">LOC: 795</td>
<td class="small">Statements: 367</td>
</tr></table>
<br><table class="log" cellpadding="5" cellspacing="0" width="100%">
<tr>
<th width="100%">Source file</th>
<th>Statements</th>
<th>Methods</th>
<th width="250" colspan="2" nowrap>Total coverage</th>
</tr>
<tr class="a">
<td>Mapper.php</td>
<td>92.9%</td>
<td>100.0%</td>
<td>93.4%</td>
<td><table cellspacing="0" cellpadding="0" border="0" width="100%" style="display: inline"><tr>
<td class="covered" width="187" height="12"> </td>
<td class="uncovered" width="13" height="12"> </td>
</tr></table></td>
</tr>
</table>
<table cellspacing="0" cellpadding="0" width="100%">
<tr>
<td class="lineCount">1</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">&lt;?php</pre></td>
</tr>
<tr>
<td class="lineCount">2</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">/**</pre></td>
</tr>
<tr>
<td class="lineCount">3</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * Xyster Framework</pre></td>
</tr>
<tr>
<td class="lineCount">4</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> *</pre></td>
</tr>
<tr>
<td class="lineCount">5</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * This source file is subject to the new BSD license that is bundled</pre></td>
</tr>
<tr>
<td class="lineCount">6</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * with this package in the file LICENSE.txt.</pre></td>
</tr>
<tr>
<td class="lineCount">7</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * It is also available through the world-wide-web at this URL:</pre></td>
</tr>
<tr>
<td class="lineCount">8</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * http://www.opensource.org/licenses/bsd-license.php</pre></td>
</tr>
<tr>
<td class="lineCount">9</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> *</pre></td>
</tr>
<tr>
<td class="lineCount">10</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * @category  Xyster</pre></td>
</tr>
<tr>
<td class="lineCount">11</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * @package   Xyster_Orm</pre></td>
</tr>
<tr>
<td class="lineCount">12</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * @copyright Copyright (c) 2007-2008 Irrational Logic (http://irrationallogic.net)</pre></td>
</tr>
<tr>
<td class="lineCount">13</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License</pre></td>
</tr>
<tr>
<td class="lineCount">14</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * @version   $Id: Mapper.php 254 2008-05-08 00:45:10Z doublecompile $</pre></td>
</tr>
<tr>
<td class="lineCount">15</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> */</pre></td>
</tr>
<tr>
<td class="lineCount">16</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">/**</pre></td>
</tr>
<tr>
<td class="lineCount">17</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * @see Xyster_Orm_Mapper_Abstract</pre></td>
</tr>
<tr>
<td class="lineCount">18</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> */</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">19</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">require_once 'Xyster/Orm/Mapper/Abstract.php';</pre></td>
</tr>
<tr>
<td class="lineCount">20</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">/**</pre></td>
</tr>
<tr>
<td class="lineCount">21</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * We might as well require this now... sets use it as well as the reportQuery</pre></td>
</tr>
<tr>
<td class="lineCount">22</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * @see Xyster_Data_Set</pre></td>
</tr>
<tr>
<td class="lineCount">23</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> */</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">24</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">require_once 'Xyster/Data/Set.php';</pre></td>
</tr>
<tr>
<td class="lineCount">25</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">/**</pre></td>
</tr>
<tr>
<td class="lineCount">26</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * A SQL implementation of the mapper interface</pre></td>
</tr>
<tr>
<td class="lineCount">27</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> *</pre></td>
</tr>
<tr>
<td class="lineCount">28</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * @see       Xyster_Orm_Mapper_Interface</pre></td>
</tr>
<tr>
<td class="lineCount">29</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * @category  Xyster</pre></td>
</tr>
<tr>
<td class="lineCount">30</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * @package   Xyster_Orm</pre></td>
</tr>
<tr>
<td class="lineCount">31</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * @copyright Copyright (c) 2007-2008 Irrational Logic (http://irrationallogic.net)</pre></td>
</tr>
<tr>
<td class="lineCount">32</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License</pre></td>
</tr>
<tr>
<td class="lineCount">33</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> */</pre></td>
</tr>
<tr>
<td class="lineCount">34</td>
<td class="coverageCount"></td>
<td class="srcLineClassStart"><pre class="srcLine">abstract class Xyster_Orm_Mapper extends Xyster_Orm_Mapper_Abstract</pre></td>
</tr>
<tr>
<td class="lineCount">35</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">{</pre></td>
</tr>
<tr>
<td class="lineCount">36</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    /**</pre></td>
</tr>
<tr>
<td class="lineCount">37</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * The data adapter</pre></td>
</tr>
<tr>
<td class="lineCount">38</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     *</pre></td>
</tr>
<tr>
<td class="lineCount">39</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @var Zend_Db_Adapter_Abstract</pre></td>
</tr>
<tr>
<td class="lineCount">40</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     */</pre></td>
</tr>
<tr>
<td class="lineCount">41</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    protected $_db;</pre></td>
</tr>
<tr>
<td class="lineCount">42</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">43</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    /**</pre></td>
</tr>
<tr>
<td class="lineCount">44</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * Information provided by the getFields() method</pre></td>
</tr>
<tr>
<td class="lineCount">45</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     *</pre></td>
</tr>
<tr>
<td class="lineCount">46</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @var array</pre></td>
</tr>
<tr>
<td class="lineCount">47</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @see getFields()</pre></td>
</tr>
<tr>
<td class="lineCount">48</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     */</pre></td>
</tr>
<tr>
<td class="lineCount">49</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    protected $_metadata = array();</pre></td>
</tr>
<tr>
<td class="lineCount">50</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">51</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    /**</pre></td>
</tr>
<tr>
<td class="lineCount">52</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * Cache for information provided the backend's getFields method</pre></td>
</tr>
<tr>
<td class="lineCount">53</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     *</pre></td>
</tr>
<tr>
<td class="lineCount">54</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @var Zend_Cache_Core</pre></td>
</tr>
<tr>
<td class="lineCount">55</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     */</pre></td>
</tr>
<tr>
<td class="lineCount">56</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    protected $_metadataCache;</pre></td>
</tr>
<tr>
<td class="lineCount">57</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">58</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    /**</pre></td>
</tr>
<tr>
<td class="lineCount">59</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * Creates a new mapper</pre></td>
</tr>
<tr>
<td class="lineCount">60</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     *</pre></td>
</tr>
<tr>
<td class="lineCount">61</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @param Xyster_Orm_Mapper_Factory_Interface $factory</pre></td>
</tr>
<tr>
<td class="lineCount">62</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @param Zend_Cache_Core $cache</pre></td>
</tr>
<tr>
<td class="lineCount">63</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     */</pre></td>
</tr>
<tr>
<td class="lineCount">64</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    final public function __construct( Xyster_Orm_Mapper_Factory_Interface $factory, Zend_Cache_Core $cache = null )</pre></td>
</tr>
<tr>
<td class="lineCount">65</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">66</td>
<td class="lineCountHighlight">22</td>
<td><pre class="srcLine">        if ( $cache ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">67</td>
<td class="lineCountHighlight">22</td>
<td><pre class="srcLine">            $this-&gt;_metadataCache = $cache;</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">68</td>
<td class="lineCountHighlight">22</td>
<td><pre class="srcLine">        } else if ( array_key_exists('metadataCache', $this-&gt;_options) ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">69</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">            $this-&gt;_metadataCache = self::_setupMetadataCache($this-&gt;_options['metadataCache']);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">70</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCount">71</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">72</td>
<td class="lineCountHighlight">22</td>
<td><pre class="srcLine">        parent::__construct($factory);</pre></td>
</tr>
<tr>
<td class="lineCount">73</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    }</pre></td>
</tr>
<tr>
<td class="lineCount">74</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">75</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    /**</pre></td>
</tr>
<tr>
<td class="lineCount">76</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * Sets up a nickname for a database adapter</pre></td>
</tr>
<tr>
<td class="lineCount">77</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     *</pre></td>
</tr>
<tr>
<td class="lineCount">78</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * This method adds a Zend_Db_Adapter_Abstract to the Zend_Registry so it</pre></td>
</tr>
<tr>
<td class="lineCount">79</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * can be retrieved later.</pre></td>
</tr>
<tr>
<td class="lineCount">80</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     *</pre></td>
</tr>
<tr>
<td class="lineCount">81</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @param string $dsn</pre></td>
</tr>
<tr>
<td class="lineCount">82</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @param string $driver</pre></td>
</tr>
<tr>
<td class="lineCount">83</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @param array $config</pre></td>
</tr>
<tr>
<td class="lineCount">84</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     */</pre></td>
</tr>
<tr>
<td class="lineCount">85</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    static public function dsn( $dsn, $driver, array $config = array() )</pre></td>
</tr>
<tr>
<td class="lineCount">86</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">87</td>
<td class="lineCountHighlight">22</td>
<td><pre class="srcLine">        require_once 'Zend/Registry.php';</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">88</td>
<td class="lineCountHighlight">22</td>
<td><pre class="srcLine">        require_once 'Zend/Db.php';</pre></td>
</tr>
<tr>
<td class="lineCount">89</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">90</td>
<td class="lineCountHighlight">22</td>
<td><pre class="srcLine">        $adapter = ( $driver instanceof Zend_Db_Adapter_Abstract ) ?</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">91</td>
<td class="lineCountHighlight">22</td>
<td><pre class="srcLine">            $driver : Zend_Db::factory($driver, $config);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">92</td>
<td class="lineCountHighlight">22</td>
<td><pre class="srcLine">        Zend_Registry::set(md5($dsn), $adapter);</pre></td>
</tr>
<tr>
<td class="lineCount">93</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    }</pre></td>
</tr>
<tr>
<td class="lineCount">94</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">95</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    /**</pre></td>
</tr>
<tr>
<td class="lineCount">96</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * Gets the first entity from the data store matching the criteria</pre></td>
</tr>
<tr>
<td class="lineCount">97</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     *</pre></td>
</tr>
<tr>
<td class="lineCount">98</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @param mixed $criteria</pre></td>
</tr>
<tr>
<td class="lineCount">99</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @return Xyster_Orm_Entity  The entity found</pre></td>
</tr>
<tr>
<td class="lineCount">100</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     */</pre></td>
</tr>
<tr>
<td class="lineCount">101</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    final public function find( $criteria )</pre></td>
</tr>
<tr>
<td class="lineCount">102</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">103</td>
<td class="lineCountHighlight">11</td>
<td><pre class="srcLine">        $_criteria = $this-&gt;_buildCriteria($criteria);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">104</td>
<td class="lineCountHighlight">11</td>
<td><pre class="srcLine">		return $this-&gt;_mapEntity($this-&gt;_fetchOne($_criteria));</pre></td>
</tr>
<tr>
<td class="lineCount">105</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    }</pre></td>
</tr>
<tr>
<td class="lineCount">106</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">107</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    /**</pre></td>
</tr>
<tr>
<td class="lineCount">108</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * Gets all entities from the data store matching the criteria</pre></td>
</tr>
<tr>
<td class="lineCount">109</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     *</pre></td>
</tr>
<tr>
<td class="lineCount">110</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @param mixed $criteria</pre></td>
</tr>
<tr>
<td class="lineCount">111</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @param mixed $sort</pre></td>
</tr>
<tr>
<td class="lineCount">112</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @return Xyster_Orm_Set  A collection of the entities</pre></td>
</tr>
<tr>
<td class="lineCount">113</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     */</pre></td>
</tr>
<tr>
<td class="lineCount">114</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    final public function findAll( $criteria, $sort = null )</pre></td>
</tr>
<tr>
<td class="lineCount">115</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">116</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">	    $select = $this-&gt;_buildSimpleSelect();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">117</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        $translator = $this-&gt;_buildTranslator();</pre></td>
</tr>
<tr>
<td class="lineCount">118</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">119</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        $token = $translator-&gt;translate($this-&gt;_buildCriteria($criteria));</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">120</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">		$select-&gt;where($token-&gt;getSql());</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">121</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">		$binds = $token-&gt;getBindValues();</pre></td>
</tr>
<tr>
<td class="lineCount">122</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">123</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">	    if ( $sort !== null ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">124</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">	        if ( !is_array($sort) ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">125</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">	            $sort = array($sort);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">126</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">	        }</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">127</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">		    foreach( $sort as $s ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">128</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">		        if (! $s instanceof Xyster_Data_Sort ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">129</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">		            require_once 'Xyster/Orm/Mapper/Exception.php';</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">130</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">                    throw new Xyster_Orm_Mapper_Exception("The sort parameter must be a single Xyster_Data_Sort or an array with multiple");</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">131</td>
<td class="coverageCountHighlight">0</td>
<td><pre class="srcLineHighlight">		        } else {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">132</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">		            $token = $translator-&gt;translateSort($s, false);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">133</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">		            $select-&gt;order($token-&gt;getSql());</pre></td>
</tr>
<tr>
<td class="lineCount">134</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">		        }</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">135</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">		    }</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">136</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">	    }</pre></td>
</tr>
<tr>
<td class="lineCount">137</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">138</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">	    return $this-&gt;_mapSet($this-&gt;_getAdapter()-&gt;query($select, $binds));</pre></td>
</tr>
<tr>
<td class="lineCount">139</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    }</pre></td>
</tr>
<tr>
<td class="lineCount">140</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">141</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    /**</pre></td>
</tr>
<tr>
<td class="lineCount">142</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * Gets all entities from the data store</pre></td>
</tr>
<tr>
<td class="lineCount">143</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     *</pre></td>
</tr>
<tr>
<td class="lineCount">144</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @param array $ids  An array of ids for which entities to retrieve</pre></td>
</tr>
<tr>
<td class="lineCount">145</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @return Xyster_Orm_Set  A collection of the entities</pre></td>
</tr>
<tr>
<td class="lineCount">146</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     */</pre></td>
</tr>
<tr>
<td class="lineCount">147</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    final public function getAll( array $ids = array() )</pre></td>
</tr>
<tr>
<td class="lineCount">148</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">149</td>
<td class="lineCountHighlight">6</td>
<td><pre class="srcLine">	    $orWhere = array();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">150</td>
<td class="lineCountHighlight">6</td>
<td><pre class="srcLine">        foreach( $ids as $id ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">151</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">    	    $id = $this-&gt;_checkPrimaryKey($id);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">152</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">            $orWhere[] = $this-&gt;_buildCriteria($id);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">153</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCount">154</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">155</td>
<td class="lineCountHighlight">6</td>
<td><pre class="srcLine">	    $select = $this-&gt;_buildSimpleSelect();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">156</td>
<td class="lineCountHighlight">6</td>
<td><pre class="srcLine">        $binds = array();</pre></td>
</tr>
<tr>
<td class="lineCount">157</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">158</td>
<td class="lineCountHighlight">6</td>
<td><pre class="srcLine">        if ( count($orWhere) ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">159</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">            require_once 'Xyster/Data/Junction.php';</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">160</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">            $translator = $this-&gt;_buildTranslator();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">161</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">            $where = Xyster_Data_Junction::fromArray('OR', $orWhere);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">162</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">            $token = $translator-&gt;translate($where);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">163</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">    		$select-&gt;where($token-&gt;getSql());</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">164</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		    $binds += $token-&gt;getBindValues();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">165</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCount">166</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">167</td>
<td class="lineCountHighlight">6</td>
<td><pre class="srcLine">	    return $this-&gt;_mapSet($this-&gt;_getAdapter()-&gt;query($select, $binds));</pre></td>
</tr>
<tr>
<td class="lineCount">168</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    }</pre></td>
</tr>
<tr>
<td class="lineCount">169</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">170</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    /**</pre></td>
</tr>
<tr>
<td class="lineCount">171</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * Gets the fields for an entity as they appear in the backend</pre></td>
</tr>
<tr>
<td class="lineCount">172</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 *</pre></td>
</tr>
<tr>
<td class="lineCount">173</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * The array should come in the format of the describeTable method of the</pre></td>
</tr>
<tr>
<td class="lineCount">174</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * Zend_Db_Adapter_Abstract class.</pre></td>
</tr>
<tr>
<td class="lineCount">175</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 *</pre></td>
</tr>
<tr>
<td class="lineCount">176</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * @see Zend_Db_Adapter_Abstract::describeTable</pre></td>
</tr>
<tr>
<td class="lineCount">177</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * @return array</pre></td>
</tr>
<tr>
<td class="lineCount">178</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 */</pre></td>
</tr>
<tr>
<td class="lineCount">179</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    final public function getFields()</pre></td>
</tr>
<tr>
<td class="lineCount">180</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">181</td>
<td class="lineCountHighlight">22</td>
<td><pre class="srcLine">        if ( !$this-&gt;_metadata ) {</pre></td>
</tr>
<tr>
<td class="lineCount">182</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">183</td>
<td class="lineCountHighlight">22</td>
<td><pre class="srcLine">            $cache = $this-&gt;getMetadataCache();</pre></td>
</tr>
<tr>
<td class="lineCount">184</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">185</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">            // If $this has a metadata cache</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">186</td>
<td class="lineCountHighlight">22</td>
<td><pre class="srcLine">	        if (null !== $cache) {</pre></td>
</tr>
<tr>
<td class="lineCount">187</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	            // Define the cache identifier where the metadata are saved</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">188</td>
<td class="lineCountHighlight">22</td>
<td><pre class="srcLine">	            $cacheId = md5($this-&gt;getTable());</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">189</td>
<td class="lineCountHighlight">22</td>
<td><pre class="srcLine">	        }</pre></td>
</tr>
<tr>
<td class="lineCount">190</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">191</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	        // If $this has no metadata cache or metadata cache misses</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">192</td>
<td class="lineCountHighlight">22</td>
<td><pre class="srcLine">	        if (null === $cache || !($metadata = $cache-&gt;load($cacheId))) {</pre></td>
</tr>
<tr>
<td class="lineCount">193</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	            // Fetch metadata from the adapter's describeTable() method</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">194</td>
<td class="lineCountHighlight">22</td>
<td><pre class="srcLine">	            $metadata = $this-&gt;_getAdapter()-&gt;describeTable($this-&gt;getTable());</pre></td>
</tr>
<tr>
<td class="lineCount">195</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	            // If $this has a metadata cache, then cache the metadata</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">196</td>
<td class="lineCountHighlight">22</td>
<td><pre class="srcLine">	            if (null !== $cache &amp;&amp; !$cache-&gt;save($metadata, $cacheId)) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">197</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">	                require_once 'Xyster/Orm/Mapper/Exception.php';</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">198</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">	                throw new Xyster_Orm_Mapper_Exception('Failed saving metadata to metadataCache');</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">199</td>
<td class="coverageCountHighlight">0</td>
<td><pre class="srcLineHighlight">	            }</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">200</td>
<td class="lineCountHighlight">22</td>
<td><pre class="srcLine">	        }</pre></td>
</tr>
<tr>
<td class="lineCount">201</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">202</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	        // Assign the metadata to $this</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">203</td>
<td class="lineCountHighlight">22</td>
<td><pre class="srcLine">	        $this-&gt;_metadata = $metadata;</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">204</td>
<td class="lineCountHighlight">22</td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">205</td>
<td class="lineCountHighlight">22</td>
<td><pre class="srcLine">        return $this-&gt;_metadata;</pre></td>
</tr>
<tr>
<td class="lineCount">206</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    }</pre></td>
</tr>
<tr>
<td class="lineCount">207</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">208</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    /**</pre></td>
</tr>
<tr>
<td class="lineCount">209</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * Gets entities via a many-to-many table</pre></td>
</tr>
<tr>
<td class="lineCount">210</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     *</pre></td>
</tr>
<tr>
<td class="lineCount">211</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @param Xyster_Orm_Entity $entity</pre></td>
</tr>
<tr>
<td class="lineCount">212</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @param Xyster_Orm_Relation $relation</pre></td>
</tr>
<tr>
<td class="lineCount">213</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @return Xyster_Orm_Set</pre></td>
</tr>
<tr>
<td class="lineCount">214</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     */</pre></td>
</tr>
<tr>
<td class="lineCount">215</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    public function getJoined( Xyster_Orm_Entity $entity, Xyster_Orm_Relation $relation )</pre></td>
</tr>
<tr>
<td class="lineCount">216</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">217</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">        $db = $this-&gt;_getAdapter();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">218</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">        $rightMap = $this-&gt;_factory-&gt;get($relation-&gt;getTo());</pre></td>
</tr>
<tr>
<td class="lineCount">219</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">220</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">        $targetTable = $rightMap-&gt;getTable();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">221</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		$targetTableAlias = 't2';</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">222</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">        $columns = array();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">223</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		foreach( $rightMap-&gt;getFields() as $name =&gt; $v ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">224</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">			$alias = $rightMap-&gt;translateField($name);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">225</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">			$columns[$alias] = $targetTableAlias.'.'.$name;</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">226</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		}</pre></td>
</tr>
<tr>
<td class="lineCount">227</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">228</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">		// get the join SQL for the left to the middle</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">229</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		$firstCond = array();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">230</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		$left = $relation-&gt;getLeft();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">231</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		foreach( $this-&gt;getEntityType()-&gt;getPrimary() as $k=&gt;$primary ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">232</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		    $firstCond[] = $db-&gt;quoteIdentifier('t1') . '.'</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">233</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		        . $db-&gt;quoteIdentifier($this-&gt;untranslateField($primary))</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">234</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		        . ' = ' . $db-&gt;quoteIdentifier($relation-&gt;getTable()) . '.'</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">235</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		        . $db-&gt;quoteIdentifier($left[$k]);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">236</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		}</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">237</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		$firstCond = implode(' AND ', $firstCond);</pre></td>
</tr>
<tr>
<td class="lineCount">238</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">239</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">		// get the join SQL for the middle to the right</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">240</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		$secondCond = array();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">241</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		$right = $relation-&gt;getRight();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">242</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		foreach( $rightMap-&gt;getEntityType()-&gt;getPrimary() as $k=&gt;$primary ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">243</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		    $secondCond[] = $db-&gt;quoteIdentifier($relation-&gt;getTable()) . '.'</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">244</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		        . $db-&gt;quoteIdentifier($right[$k]) . ' = '</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">245</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		        . $db-&gt;quoteIdentifier($targetTableAlias) . '.'</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">246</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		        . $db-&gt;quoteIdentifier($rightMap-&gt;untranslateField($primary));</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">247</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		}</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">248</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		$secondCond = implode(' AND ', $secondCond);</pre></td>
</tr>
<tr>
<td class="lineCount">249</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">250</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		$select = $this-&gt;_getAdapter()-&gt;select();</pre></td>
</tr>
<tr>
<td class="lineCount">251</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">252</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		$translator = $this-&gt;_buildTranslator();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">253</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		$translator-&gt;setTable('t1');</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">254</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		$token = $translator-&gt;translate($entity-&gt;getPrimaryKeyAsCriterion());</pre></td>
</tr>
<tr>
<td class="lineCount">255</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">256</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		$binds = $token-&gt;getBindValues();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">257</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		$select-&gt;from(array('t1'=&gt;$this-&gt;getTable()), array())</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">258</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		    -&gt;join($relation-&gt;getTable(), $firstCond, array())</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">259</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		    -&gt;join(array($targetTableAlias=&gt;$targetTable), $secondCond, $columns)</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">260</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		    -&gt;where($token-&gt;getSql());</pre></td>
</tr>
<tr>
<td class="lineCount">261</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">262</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		return $rightMap-&gt;_mapSet($this-&gt;_getAdapter()-&gt;query($select, $binds));</pre></td>
</tr>
<tr>
<td class="lineCount">263</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    }</pre></td>
</tr>
<tr>
<td class="lineCount">264</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">265</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    /**</pre></td>
</tr>
<tr>
<td class="lineCount">266</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * Gets the metadata cache</pre></td>
</tr>
<tr>
<td class="lineCount">267</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     *</pre></td>
</tr>
<tr>
<td class="lineCount">268</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @return Zend_Cache_Core</pre></td>
</tr>
<tr>
<td class="lineCount">269</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     */</pre></td>
</tr>
<tr>
<td class="lineCount">270</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    final public function getMetadataCache()</pre></td>
</tr>
<tr>
<td class="lineCount">271</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">272</td>
<td class="lineCountHighlight">22</td>
<td><pre class="srcLine">        return $this-&gt;_metadataCache;</pre></td>
</tr>
<tr>
<td class="lineCount">273</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    }</pre></td>
</tr>
<tr>
<td class="lineCount">274</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">275</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    /**</pre></td>
</tr>
<tr>
<td class="lineCount">276</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * Gets the sequence of this table</pre></td>
</tr>
<tr>
<td class="lineCount">277</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     *</pre></td>
</tr>
<tr>
<td class="lineCount">278</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @return string The sequence</pre></td>
</tr>
<tr>
<td class="lineCount">279</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     */</pre></td>
</tr>
<tr>
<td class="lineCount">280</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    final public function getSequence()</pre></td>
</tr>
<tr>
<td class="lineCount">281</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">282</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        return $this-&gt;getOption('sequence');</pre></td>
</tr>
<tr>
<td class="lineCount">283</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    }</pre></td>
</tr>
<tr>
<td class="lineCount">284</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">285</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    /**</pre></td>
</tr>
<tr>
<td class="lineCount">286</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * Performs a query</pre></td>
</tr>
<tr>
<td class="lineCount">287</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 *</pre></td>
</tr>
<tr>
<td class="lineCount">288</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * @param Xyster_Orm_Query $query  The query details</pre></td>
</tr>
<tr>
<td class="lineCount">289</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * @return Xyster_Data_Set</pre></td>
</tr>
<tr>
<td class="lineCount">290</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 */</pre></td>
</tr>
<tr>
<td class="lineCount">291</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	public function query( Xyster_Orm_Query $query )</pre></td>
</tr>
<tr>
<td class="lineCount">292</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	{</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">293</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">	    $db = $this-&gt;_getAdapter();</pre></td>
</tr>
<tr>
<td class="lineCount">294</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">295</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">        require_once 'Xyster/Orm/Mapper/Translator.php';</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">296</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		$translator = new Xyster_Orm_Mapper_Translator($db,</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">297</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		    $this-&gt;getEntityName(), $this-&gt;_factory);</pre></td>
</tr>
<tr>
<td class="lineCount">298</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">299</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		$select = $db-&gt;select();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">300</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		$binds = array();</pre></td>
</tr>
<tr>
<td class="lineCount">301</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">302</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">		// apply the where clause that can be run on the database</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">303</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		foreach( $query-&gt;getBackendWhere() as $criterion ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">304</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">			$whereToken = $translator-&gt;translateCriterion($criterion);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">305</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">			$select-&gt;where( $whereToken-&gt;getSql() );</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">306</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">			$binds += $whereToken-&gt;getBindValues();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">307</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		}</pre></td>
</tr>
<tr>
<td class="lineCount">308</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">309</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">		// apply the order by clause that can be run on the database</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">310</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		if ( !$query-&gt;hasRuntimeOrder() ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">311</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">			foreach( $query-&gt;getOrder() as $sort ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">312</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">				$select-&gt;order($translator-&gt;translateSort($sort, false)-&gt;getSql());</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">313</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">			}</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">314</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		}</pre></td>
</tr>
<tr>
<td class="lineCount">315</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">316</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">		// if the query is entirely against the database, add limit &amp; offset</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">317</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		if ( !$query-&gt;isRuntime() &amp;&amp; $query-&gt;getLimit() ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">318</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">		    $select-&gt;limit($query-&gt;getLimit(), $query-&gt;getOffset());</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">319</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">		}</pre></td>
</tr>
<tr>
<td class="lineCount">320</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">321</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">		if (! $query instanceof Xyster_Orm_Query_Report ) {</pre></td>
</tr>
<tr>
<td class="lineCount">322</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">323</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">		    // add the from clause, joins, and columns</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">324</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">			$select-&gt;from(array($translator-&gt;getMain() =&gt; $this-&gt;getTable()), $this-&gt;_selectColumns());</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">325</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">			foreach( $translator-&gt;getFromClause() as $table =&gt; $joinToken ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">326</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">			    $select-&gt;joinLeft($table, $joinToken-&gt;getSql(), array());</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">327</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">			    $binds += $joinToken-&gt;getBindValues();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">328</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">			}</pre></td>
</tr>
<tr>
<td class="lineCount">329</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">330</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">			return $this-&gt;_mapSet($db-&gt;query($select, $binds));</pre></td>
</tr>
<tr>
<td class="lineCount">331</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">332</td>
<td class="coverageCountHighlight">0</td>
<td><pre class="srcLineHighlight">		} else {</pre></td>
</tr>
<tr>
<td class="lineCount">333</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">334</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">		    // pretty self explanitory...</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">335</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">            $select-&gt;distinct($query-&gt;isDistinct());</pre></td>
</tr>
<tr>
<td class="lineCount">336</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">337</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">	        $fields = array();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">338</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">			if ( !$query-&gt;isRuntime() ) {</pre></td>
</tr>
<tr>
<td class="lineCount">339</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">340</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">				foreach( $query-&gt;getFields() as $k=&gt;$field ) {</pre></td>
</tr>
<tr>
<td class="lineCount">341</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">				    // we want to quote the field names for aggregates!</pre></td>
</tr>
<tr>
<td class="lineCount">342</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	                // Zend_Db_Select does not do this for functions</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">343</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">				    $quote = ($field instanceof Xyster_Data_Field_Aggregate);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">344</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">				    $fieldName = $translator-&gt;translateField($field, $quote)-&gt;getSql();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">345</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">				    if ( $field-&gt;getAlias() == $field-&gt;getName() ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">346</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">				        $fields[] = $fieldName;</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">347</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">				    } else {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">348</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">				        $fields[$field-&gt;getAlias()] = $fieldName;</pre></td>
</tr>
<tr>
<td class="lineCount">349</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">				    }</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">350</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">				}</pre></td>
</tr>
<tr>
<td class="lineCount">351</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">352</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">				if ( count($query-&gt;getGroup()) ) {</pre></td>
</tr>
<tr>
<td class="lineCount">353</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">				    // add the group clause</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">354</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">					foreach( $query-&gt;getGroup() as $k=&gt;$grp ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">355</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">						$fieldName = $translator-&gt;translateField($grp, false)-&gt;getSql();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">356</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">						if ( $grp-&gt;getAlias() == $grp-&gt;getName() ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">357</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">						    $fields[] = $fieldName;</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">358</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">						} else {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">359</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">						    $fields[$grp-&gt;getAlias()] = $fieldName;</pre></td>
</tr>
<tr>
<td class="lineCount">360</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">						}</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">361</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">						$select-&gt;group($fieldName);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">362</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">					}</pre></td>
</tr>
<tr>
<td class="lineCount">363</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">					// add the having clause</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">364</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">					foreach( $query-&gt;getHaving() as $k=&gt;$crit ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">365</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">						$whereToken = $translator-&gt;translateCriterion($crit);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">366</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">						$select-&gt;having($whereToken-&gt;getSql());</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">367</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">						$binds += $whereToken-&gt;getBindValues();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">368</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">					}</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">369</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">				}</pre></td>
</tr>
<tr>
<td class="lineCount">370</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">371</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">			} else {</pre></td>
</tr>
<tr>
<td class="lineCount">372</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			    // it's runtime, just pull back all fields in the main table</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">373</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">			    $fields = $this-&gt;_selectColumns();</pre></td>
</tr>
<tr>
<td class="lineCount">374</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			}</pre></td>
</tr>
<tr>
<td class="lineCount">375</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">376</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			// add the from clause, joins, and columns</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">377</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">		    $select-&gt;from(array($translator-&gt;getMain() =&gt; $this-&gt;getTable()), $fields);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">378</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">			foreach( $translator-&gt;getFromClause() as $table =&gt; $joinToken ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">379</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">			    $select-&gt;joinLeft($table, $joinToken-&gt;getSql(), array());</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">380</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">			    $binds += $joinToken-&gt;getBindValues();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">381</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">			}</pre></td>
</tr>
<tr>
<td class="lineCount">382</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">383</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">			if ( !$query-&gt;isRuntime() ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">384</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">			    $result = $db-&gt;query($select, $binds)-&gt;fetchAll(Zend_Db::FETCH_ASSOC);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">385</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">				return new Xyster_Data_Set(Xyster_Collection::using($result));</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">386</td>
<td class="coverageCountHighlight">0</td>
<td><pre class="srcLineHighlight">			} else {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">387</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">			    return $this-&gt;_mapSet($db-&gt;query($select, $binds));</pre></td>
</tr>
<tr>
<td class="lineCount">388</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			}</pre></td>
</tr>
<tr>
<td class="lineCount">389</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">		}</pre></td>
</tr>
<tr>
<td class="lineCount">390</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	}</pre></td>
</tr>
<tr>
<td class="lineCount">391</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">392</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    /**</pre></td>
</tr>
<tr>
<td class="lineCount">393</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * Reloads an entity's values with fresh ones from the backend</pre></td>
</tr>
<tr>
<td class="lineCount">394</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 *</pre></td>
</tr>
<tr>
<td class="lineCount">395</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * @param Xyster_Orm_Entity $entity  The entity to refresh</pre></td>
</tr>
<tr>
<td class="lineCount">396</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 */</pre></td>
</tr>
<tr>
<td class="lineCount">397</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	public function refresh( Xyster_Orm_Entity $entity )</pre></td>
</tr>
<tr>
<td class="lineCount">398</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	{</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">399</td>
<td class="lineCountHighlight">9</td>
<td><pre class="srcLine">	    $this-&gt;_mapEntity($this-&gt;_fetchOne($entity-&gt;getPrimaryKeyAsCriterion()), $entity);</pre></td>
</tr>
<tr>
<td class="lineCount">400</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	}</pre></td>
</tr>
<tr>
<td class="lineCount">401</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">402</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    /**</pre></td>
</tr>
<tr>
<td class="lineCount">403</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * Gets a simple Select object for this table</pre></td>
</tr>
<tr>
<td class="lineCount">404</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     *</pre></td>
</tr>
<tr>
<td class="lineCount">405</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @return Zend_Db_Select</pre></td>
</tr>
<tr>
<td class="lineCount">406</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     */</pre></td>
</tr>
<tr>
<td class="lineCount">407</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    protected function _buildSimpleSelect()</pre></td>
</tr>
<tr>
<td class="lineCount">408</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">409</td>
<td class="lineCountHighlight">15</td>
<td><pre class="srcLine">        $select = $this-&gt;_getAdapter()-&gt;select();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">410</td>
<td class="lineCountHighlight">15</td>
<td><pre class="srcLine">		$select-&gt;from(array('t1' =&gt; $this-&gt;getTable()), $this-&gt;_selectColumns());</pre></td>
</tr>
<tr>
<td class="lineCount">411</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">412</td>
<td class="lineCountHighlight">15</td>
<td><pre class="srcLine">		return $select;</pre></td>
</tr>
<tr>
<td class="lineCount">413</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    }</pre></td>
</tr>
<tr>
<td class="lineCount">414</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">415</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    /**</pre></td>
</tr>
<tr>
<td class="lineCount">416</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * Gets a Mapper Translator object</pre></td>
</tr>
<tr>
<td class="lineCount">417</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     *</pre></td>
</tr>
<tr>
<td class="lineCount">418</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @return Xyster_Db_Translator</pre></td>
</tr>
<tr>
<td class="lineCount">419</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     */</pre></td>
</tr>
<tr>
<td class="lineCount">420</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    protected function _buildTranslator()</pre></td>
</tr>
<tr>
<td class="lineCount">421</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">422</td>
<td class="lineCountHighlight">14</td>
<td><pre class="srcLine">        require_once 'Xyster/Db/Translator.php';</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">423</td>
<td class="lineCountHighlight">14</td>
<td><pre class="srcLine">		$translator = new Xyster_Db_Translator($this-&gt;_getAdapter());</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">424</td>
<td class="lineCountHighlight">14</td>
<td><pre class="srcLine">		$translator-&gt;setRenameCallback(array($this, 'untranslateField'));</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">425</td>
<td class="lineCountHighlight">14</td>
<td><pre class="srcLine">		return $translator;</pre></td>
</tr>
<tr>
<td class="lineCount">426</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    }</pre></td>
</tr>
<tr>
<td class="lineCount">427</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">428</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	/**</pre></td>
</tr>
<tr>
<td class="lineCount">429</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * Removes entities from the backend</pre></td>
</tr>
<tr>
<td class="lineCount">430</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 *</pre></td>
</tr>
<tr>
<td class="lineCount">431</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * @param Xyster_Data_Criterion $where The criteria on which to remove entities</pre></td>
</tr>
<tr>
<td class="lineCount">432</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * @return int The number of rows deleted</pre></td>
</tr>
<tr>
<td class="lineCount">433</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 */</pre></td>
</tr>
<tr>
<td class="lineCount">434</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	protected function _delete( Xyster_Data_Criterion $where )</pre></td>
</tr>
<tr>
<td class="lineCount">435</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	{</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">436</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">	    $translator = $this-&gt;_buildTranslator();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">437</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">		$token = $translator-&gt;translateCriterion($where);</pre></td>
</tr>
<tr>
<td class="lineCount">438</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">439</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">		$stmt = $this-&gt;_getAdapter()-&gt;prepare('DELETE FROM '</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">440</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">			. $this-&gt;_getAdapter()-&gt;quoteIdentifier($this-&gt;getTable())</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">441</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">		    . ' WHERE ' . $token-&gt;getSql());</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">442</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">		$stmt-&gt;execute($token-&gt;getBindValues());</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">443</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">		return $stmt-&gt;rowCount();</pre></td>
</tr>
<tr>
<td class="lineCount">444</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	}</pre></td>
</tr>
<tr>
<td class="lineCount">445</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">446</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	/**</pre></td>
</tr>
<tr>
<td class="lineCount">447</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * Fetches one record</pre></td>
</tr>
<tr>
<td class="lineCount">448</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 *</pre></td>
</tr>
<tr>
<td class="lineCount">449</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * @param Xyster_Data_Criterion $where</pre></td>
</tr>
<tr>
<td class="lineCount">450</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * @return Zend_Db_Statement_Interface</pre></td>
</tr>
<tr>
<td class="lineCount">451</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 */</pre></td>
</tr>
<tr>
<td class="lineCount">452</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	protected function _fetchOne( Xyster_Data_Criterion $where )</pre></td>
</tr>
<tr>
<td class="lineCount">453</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	{</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">454</td>
<td class="lineCountHighlight">12</td>
<td><pre class="srcLine">	    $select = $this-&gt;_buildSimpleSelect();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">455</td>
<td class="lineCountHighlight">12</td>
<td><pre class="srcLine">		$select-&gt;limit(1);</pre></td>
</tr>
<tr>
<td class="lineCount">456</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">457</td>
<td class="lineCountHighlight">12</td>
<td><pre class="srcLine">		$translator = $this-&gt;_buildTranslator();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">458</td>
<td class="lineCountHighlight">12</td>
<td><pre class="srcLine">	    $token = $translator-&gt;translate($where);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">459</td>
<td class="lineCountHighlight">12</td>
<td><pre class="srcLine">		$select-&gt;where($token-&gt;getSql());</pre></td>
</tr>
<tr>
<td class="lineCount">460</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">461</td>
<td class="lineCountHighlight">12</td>
<td><pre class="srcLine">		return $this-&gt;_getAdapter()-&gt;query($select, $token-&gt;getBindValues());</pre></td>
</tr>
<tr>
<td class="lineCount">462</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	}</pre></td>
</tr>
<tr>
<td class="lineCount">463</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">464</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	/**</pre></td>
</tr>
<tr>
<td class="lineCount">465</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * Gets a connection to the database</pre></td>
</tr>
<tr>
<td class="lineCount">466</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 *</pre></td>
</tr>
<tr>
<td class="lineCount">467</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * @return Zend_Db_Adapter_Abstract A connection to the database</pre></td>
</tr>
<tr>
<td class="lineCount">468</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * @throws Xyster_Orm_Mapper_Exception</pre></td>
</tr>
<tr>
<td class="lineCount">469</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 */</pre></td>
</tr>
<tr>
<td class="lineCount">470</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	final protected function _getAdapter()</pre></td>
</tr>
<tr>
<td class="lineCount">471</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	{</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">472</td>
<td class="lineCountHighlight">22</td>
<td><pre class="srcLine">	    if (! $this-&gt;_db instanceof Zend_Db_Adapter_Abstract ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">473</td>
<td class="lineCountHighlight">22</td>
<td><pre class="srcLine">            $key = md5($this-&gt;getDomain());</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">474</td>
<td class="lineCountHighlight">22</td>
<td><pre class="srcLine">            require_once 'Zend/Registry.php';</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">475</td>
<td class="lineCountHighlight">22</td>
<td><pre class="srcLine">            $db = Zend_Registry::isRegistered($key) ? Zend_Registry::get($key) : null;</pre></td>
</tr>
<tr>
<td class="lineCount">476</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">477</td>
<td class="lineCountHighlight">22</td>
<td><pre class="srcLine">            if (!$db instanceof Zend_Db_Adapter_Abstract) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">478</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">                require_once 'Xyster/Orm/Mapper/Exception.php';</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">479</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">                throw new Xyster_Orm_Mapper_Exception('A database connection has not been defined.  Please call the static "dsn" method to do so.');</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">480</td>
<td class="coverageCountHighlight">0</td>
<td><pre class="srcLineHighlight">            }</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">481</td>
<td class="lineCountHighlight">22</td>
<td><pre class="srcLine">            $this-&gt;_db = $db;</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">482</td>
<td class="lineCountHighlight">22</td>
<td><pre class="srcLine">	    }</pre></td>
</tr>
<tr>
<td class="lineCount">483</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">484</td>
<td class="lineCountHighlight">22</td>
<td><pre class="srcLine">        return $this-&gt;_db;</pre></td>
</tr>
<tr>
<td class="lineCount">485</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    }</pre></td>
</tr>
<tr>
<td class="lineCount">486</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">487</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    /**</pre></td>
</tr>
<tr>
<td class="lineCount">488</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * Saves a new entity into the backend</pre></td>
</tr>
<tr>
<td class="lineCount">489</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 *</pre></td>
</tr>
<tr>
<td class="lineCount">490</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * @param Xyster_Orm_Entity $entity  The entity to insert</pre></td>
</tr>
<tr>
<td class="lineCount">491</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * @return mixed  The new primary key</pre></td>
</tr>
<tr>
<td class="lineCount">492</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 */</pre></td>
</tr>
<tr>
<td class="lineCount">493</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	protected function _insert( Xyster_Orm_Entity $entity )</pre></td>
</tr>
<tr>
<td class="lineCount">494</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	{</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">495</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">	    $db = $this-&gt;_getAdapter();</pre></td>
</tr>
<tr>
<td class="lineCount">496</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">497</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">	    $data = array();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">498</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">	    foreach( $entity-&gt;toArray() as $name =&gt; $value ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">499</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">	        $data[ $this-&gt;untranslateField($name) ] = $value;</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">500</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">	    }</pre></td>
</tr>
<tr>
<td class="lineCount">501</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">502</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">        /**</pre></td>
</tr>
<tr>
<td class="lineCount">503</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">         * This class assumes that if you have a compound primary key</pre></td>
</tr>
<tr>
<td class="lineCount">504</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">         * and one of the columns in the key uses a sequence,</pre></td>
</tr>
<tr>
<td class="lineCount">505</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">         * it's the _first_ column in the compound key.</pre></td>
</tr>
<tr>
<td class="lineCount">506</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">         */</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">507</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        $primary = array_map(array($this, 'untranslateField'),</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">508</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">            $this-&gt;getEntityType()-&gt;getPrimary());</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">509</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        $pkIdentity = $primary[0];</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">510</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        if ( count($primary) &gt; 0 ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">511</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">	        $fields = $this-&gt;getEntityType()-&gt;getFields();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">512</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">	        foreach( $fields as $field ) {</pre></td>
</tr>
<tr>
<td class="lineCount">513</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	            /* @var $field Xyster_Orm_Entity_Field */</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">514</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">	            if ( $field-&gt;isIdentity() ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">515</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">	                $posn = $field-&gt;getPrimaryPosition() - 1;</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">516</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">	                $pkIdentity = $primary[ $posn ];</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">517</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">	            }</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">518</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">	        }</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">519</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCount">520</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">521</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        $sequence = $this-&gt;getSequence();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">522</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        if ( !$sequence &amp;&amp; $db instanceof Zend_Db_Adapter_Pdo_Pgsql ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">523</td>
<td class="coverageCountHighlight">0</td>
<td><pre class="srcLineHighlight">            $sequence = $this-&gt;getTable() . "_" . $pkIdentity . "_seq";</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">524</td>
<td class="coverageCountHighlight">0</td>
<td><pre class="srcLineHighlight">        }</pre></td>
</tr>
<tr>
<td class="lineCount">525</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">526</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">        /**</pre></td>
</tr>
<tr>
<td class="lineCount">527</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">         * If this table uses a database sequence object and the data does not</pre></td>
</tr>
<tr>
<td class="lineCount">528</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">         * specify a value, then get the next ID from the sequence and add it</pre></td>
</tr>
<tr>
<td class="lineCount">529</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">         * to the row.  We assume that only the first column in a compound</pre></td>
</tr>
<tr>
<td class="lineCount">530</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">         * primary key takes a value from a sequence.</pre></td>
</tr>
<tr>
<td class="lineCount">531</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">         */</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">532</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        if ( $sequence &amp;&amp; !$data[$pkIdentity]) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">533</td>
<td class="coverageCountHighlight">0</td>
<td><pre class="srcLineHighlight">            $data[$pkIdentity] = $db-&gt;nextSequenceId($sequence);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">534</td>
<td class="coverageCountHighlight">0</td>
<td><pre class="srcLineHighlight">        }</pre></td>
</tr>
<tr>
<td class="lineCount">535</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">536</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	    /**</pre></td>
</tr>
<tr>
<td class="lineCount">537</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">         * If the primary key can be generated automatically, and no value was</pre></td>
</tr>
<tr>
<td class="lineCount">538</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">         * specified in the user-supplied data, then omit it from the tuple</pre></td>
</tr>
<tr>
<td class="lineCount">539</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">         */</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">540</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        if ( array_key_exists($pkIdentity, $data) &amp;&amp; $data[$pkIdentity] === null ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">541</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">            unset($data[$pkIdentity]);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">542</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCount">543</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">544</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        $db-&gt;insert($this-&gt;getTable(), $data);</pre></td>
</tr>
<tr>
<td class="lineCount">545</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">546</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        $primaryKey = null;</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">547</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        if ( isset($data[$pkIdentity]) ) {</pre></td>
</tr>
<tr>
<td class="lineCount">548</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">            /**</pre></td>
</tr>
<tr>
<td class="lineCount">549</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">             * Return the primary key value or array of values if the</pre></td>
</tr>
<tr>
<td class="lineCount">550</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">             * primary key is compound.  This handles:</pre></td>
</tr>
<tr>
<td class="lineCount">551</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">             * - natural keys</pre></td>
</tr>
<tr>
<td class="lineCount">552</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">             * - sequence-driven keys</pre></td>
</tr>
<tr>
<td class="lineCount">553</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">             * - auto-increment keys when the user specifies a value</pre></td>
</tr>
<tr>
<td class="lineCount">554</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">             */</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">555</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">            $pkData = array_intersect_key($data, array_flip($primary));</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">556</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">            if (count($primary) == 1) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">557</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">                $primaryKey = current($pkData);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">558</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">            } else {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">559</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">                $primaryKey = $pkData;</pre></td>
</tr>
<tr>
<td class="lineCount">560</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">            }</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">561</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCount">562</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">563</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        if (!$sequence) {</pre></td>
</tr>
<tr>
<td class="lineCount">564</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">            /**</pre></td>
</tr>
<tr>
<td class="lineCount">565</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">             * Return the most recent ID generated by an auto-increment column</pre></td>
</tr>
<tr>
<td class="lineCount">566</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">             */</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">567</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">            $primaryKey = $db-&gt;lastInsertId();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">568</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCount">569</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">570</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">        /**</pre></td>
</tr>
<tr>
<td class="lineCount">571</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">         * Normalize the result to an array indexed by primary key column(s).</pre></td>
</tr>
<tr>
<td class="lineCount">572</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">         */</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">573</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        $newPrimaryKey = is_array($primaryKey) ?</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">574</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">            $primaryKey : array(current($primary) =&gt; $primaryKey);</pre></td>
</tr>
<tr>
<td class="lineCount">575</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">576</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        foreach( $newPrimaryKey as $name =&gt; $value ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">577</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">            $field = $this-&gt;translateField($name);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">578</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">            $entity-&gt;$field = $value;</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">579</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCount">580</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">581</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">    	return $newPrimaryKey;</pre></td>
</tr>
<tr>
<td class="lineCount">582</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	}</pre></td>
</tr>
<tr>
<td class="lineCount">583</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">584</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    /**</pre></td>
</tr>
<tr>
<td class="lineCount">585</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * Adds the entities to the many-to-many join</pre></td>
</tr>
<tr>
<td class="lineCount">586</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     *</pre></td>
</tr>
<tr>
<td class="lineCount">587</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @param Xyster_Orm_Set $set</pre></td>
</tr>
<tr>
<td class="lineCount">588</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     */</pre></td>
</tr>
<tr>
<td class="lineCount">589</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    protected function _joinedInsert( Xyster_Orm_Set $set )</pre></td>
</tr>
<tr>
<td class="lineCount">590</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">591</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        $entity = $set-&gt;getRelatedEntity();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">592</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        $relation = $set-&gt;getRelation();</pre></td>
</tr>
<tr>
<td class="lineCount">593</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">594</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        $leftValues = array();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">595</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        $left = $relation-&gt;getLeft();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">596</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        foreach( $this-&gt;getEntityType()-&gt;getPrimary() as $k=&gt;$primary ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">597</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">            $leftValues[$left[$k]] = $entity-&gt;$primary;</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">598</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCount">599</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">600</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        $rightMap = $this-&gt;getFactory()-&gt;get($relation-&gt;getTo());</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">601</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        $right = $relation-&gt;getRight();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">602</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        $rightPrimary = $rightMap-&gt;getEntityType()-&gt;getPrimary();</pre></td>
</tr>
<tr>
<td class="lineCount">603</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">604</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        foreach( $set-&gt;getDiffAdded() as $added ) {</pre></td>
</tr>
<tr>
<td class="lineCount">605</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">            /* @var $added Xyster_Orm_Entity */</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">606</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">            if ( !$added-&gt;getBase() ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">607</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">                $rightMap-&gt;save($added);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">608</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">            }</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">609</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">            $values = $leftValues;</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">610</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">            foreach( $rightPrimary as $k=&gt;$primary ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">611</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">                $values[$right[$k]] = $added-&gt;$primary;</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">612</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">            }</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">613</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">            $this-&gt;_getAdapter()-&gt;insert($relation-&gt;getTable(), $values);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">614</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCount">615</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    }</pre></td>
</tr>
<tr>
<td class="lineCount">616</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">617</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    /**</pre></td>
</tr>
<tr>
<td class="lineCount">618</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * Removes the entities from the many-to-many join</pre></td>
</tr>
<tr>
<td class="lineCount">619</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     *</pre></td>
</tr>
<tr>
<td class="lineCount">620</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @param Xyster_Orm_Set $set</pre></td>
</tr>
<tr>
<td class="lineCount">621</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     */</pre></td>
</tr>
<tr>
<td class="lineCount">622</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    protected function _joinedDelete( Xyster_Orm_Set $set )</pre></td>
</tr>
<tr>
<td class="lineCount">623</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">624</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        $entity = $set-&gt;getRelatedEntity();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">625</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        $relation = $set-&gt;getRelation();</pre></td>
</tr>
<tr>
<td class="lineCount">626</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">627</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">		$firstCond = array();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">628</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">		$left = $relation-&gt;getLeft();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">629</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">		foreach( $this-&gt;getEntityType()-&gt;getPrimary() as $k=&gt;$primary ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">630</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">		    $firstCond[] = Xyster_Data_Expression::eq($left[$k], $entity-&gt;$primary);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">631</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">		}</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">632</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">		$leftCriteria = Xyster_Data_Criterion::fromArray('AND', $firstCond);</pre></td>
</tr>
<tr>
<td class="lineCount">633</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">634</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        $rightMap = $this-&gt;getFactory()-&gt;get($relation-&gt;getTo());</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">635</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">		$right = $relation-&gt;getRight();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">636</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">		$rightPrimary = $rightMap-&gt;getEntityType()-&gt;getPrimary();</pre></td>
</tr>
<tr>
<td class="lineCount">637</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">638</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">		$diffRemoved = $set-&gt;getDiffRemoved();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">639</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">		if ( !count($diffRemoved) ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">640</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">		    return;</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">641</td>
<td class="coverageCountHighlight">0</td>
<td><pre class="srcLineHighlight">		}</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">642</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">		$secondCriteria = array();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">643</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">		foreach( $diffRemoved as $removed ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">644</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">		    $secondCond = array();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">645</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">		    foreach( $rightPrimary as $k=&gt;$primary ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">646</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">    		    $secondCond[] = Xyster_Data_Expression::eq($right[$k], $removed-&gt;$primary);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">647</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">    		}</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">648</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">    		$secondCriteria[] = Xyster_Data_Criterion::fromArray('AND', $secondCond);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">649</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">		}</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">650</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">		$allSecondCriteria = Xyster_Data_Criterion::fromArray('OR', $secondCriteria);</pre></td>
</tr>
<tr>
<td class="lineCount">651</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">652</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">		$where = Xyster_Data_Junction::all($leftCriteria, $allSecondCriteria);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">653</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">		$translator = new Xyster_Db_Translator($this-&gt;_getAdapter());</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">654</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">		$token = $translator-&gt;translate($where);</pre></td>
</tr>
<tr>
<td class="lineCount">655</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">656</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">		$stmt = $this-&gt;_getAdapter()-&gt;prepare('DELETE FROM '</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">657</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">		    . $this-&gt;_getAdapter()-&gt;quoteIdentifier($relation-&gt;getTable())</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">658</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">		    . ' WHERE ' . $token-&gt;getSql());</pre></td>
</tr>
<tr>
<td class="lineCount">659</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">660</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">		$stmt-&gt;execute($token-&gt;getBindValues());</pre></td>
</tr>
<tr>
<td class="lineCount">661</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    }</pre></td>
</tr>
<tr>
<td class="lineCount">662</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">663</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	/**</pre></td>
</tr>
<tr>
<td class="lineCount">664</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * Translates the first row of a database recordset into an entity</pre></td>
</tr>
<tr>
<td class="lineCount">665</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 *</pre></td>
</tr>
<tr>
<td class="lineCount">666</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * @param Zend_Db_Statement_Interface $stmt A statement containing the row to translate</pre></td>
</tr>
<tr>
<td class="lineCount">667</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * @param Xyster_Orm_Entity $entity  Optional.  An entity to refresh</pre></td>
</tr>
<tr>
<td class="lineCount">668</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * @return Xyster_Orm_Entity  The translated entity</pre></td>
</tr>
<tr>
<td class="lineCount">669</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 */</pre></td>
</tr>
<tr>
<td class="lineCount">670</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	protected function _mapEntity( Zend_Db_Statement_Interface $stmt, Xyster_Orm_Entity $entity = null )</pre></td>
</tr>
<tr>
<td class="lineCount">671</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	{</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">672</td>
<td class="lineCountHighlight">12</td>
<td><pre class="srcLine">	    $return = null;</pre></td>
</tr>
<tr>
<td class="lineCount">673</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">674</td>
<td class="lineCountHighlight">12</td>
<td><pre class="srcLine">		if ( $row = $stmt-&gt;fetch(Zend_Db::FETCH_ASSOC) ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">675</td>
<td class="lineCountHighlight">11</td>
<td><pre class="srcLine">			$this-&gt;_checkPropertyNames($row);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">676</td>
<td class="lineCountHighlight">11</td>
<td><pre class="srcLine">			$stmt-&gt;closeCursor();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">677</td>
<td class="lineCountHighlight">11</td>
<td><pre class="srcLine">			if ( $entity instanceof Xyster_Orm_Entity ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">678</td>
<td class="lineCountHighlight">8</td>
<td><pre class="srcLine">			    $return = $entity-&gt;import($row);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">679</td>
<td class="lineCountHighlight">8</td>
<td><pre class="srcLine">			} else {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">680</td>
<td class="lineCountHighlight">11</td>
<td><pre class="srcLine">			    $return = $this-&gt;_create($row);</pre></td>
</tr>
<tr>
<td class="lineCount">681</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">			}</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">682</td>
<td class="lineCountHighlight">11</td>
<td><pre class="srcLine">		}</pre></td>
</tr>
<tr>
<td class="lineCount">683</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">684</td>
<td class="lineCountHighlight">12</td>
<td><pre class="srcLine">		return $return;</pre></td>
</tr>
<tr>
<td class="lineCount">685</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	}</pre></td>
</tr>
<tr>
<td class="lineCount">686</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">687</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    /**</pre></td>
</tr>
<tr>
<td class="lineCount">688</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * Translates a database recordset into an entity set</pre></td>
</tr>
<tr>
<td class="lineCount">689</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 *</pre></td>
</tr>
<tr>
<td class="lineCount">690</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * @param Zend_Db_Statement_Interface $stmt A statement containing rows to translate</pre></td>
</tr>
<tr>
<td class="lineCount">691</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * @return Xyster_Orm_Set  The translated set</pre></td>
</tr>
<tr>
<td class="lineCount">692</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 */</pre></td>
</tr>
<tr>
<td class="lineCount">693</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	protected function _mapSet( Zend_Db_Statement_Interface $stmt )</pre></td>
</tr>
<tr>
<td class="lineCount">694</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	{</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">695</td>
<td class="lineCountHighlight">10</td>
<td><pre class="srcLine">		$entities = array();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">696</td>
<td class="lineCountHighlight">10</td>
<td><pre class="srcLine">		$stmt-&gt;setFetchMode(Zend_Db::FETCH_ASSOC);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">697</td>
<td class="lineCountHighlight">10</td>
<td><pre class="srcLine">		foreach( $stmt-&gt;fetchAll() as $k =&gt; $row ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">698</td>
<td class="lineCountHighlight">10</td>
<td><pre class="srcLine">			if ( $k&lt;1 ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">699</td>
<td class="lineCountHighlight">10</td>
<td><pre class="srcLine">				$this-&gt;_checkPropertyNames($row);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">700</td>
<td class="lineCountHighlight">10</td>
<td><pre class="srcLine">			}</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">701</td>
<td class="lineCountHighlight">10</td>
<td><pre class="srcLine">			$entities[] = $this-&gt;_create($row);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">702</td>
<td class="lineCountHighlight">10</td>
<td><pre class="srcLine">		}</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">703</td>
<td class="lineCountHighlight">10</td>
<td><pre class="srcLine">		$stmt-&gt;closeCursor();</pre></td>
</tr>
<tr>
<td class="lineCount">704</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">705</td>
<td class="lineCountHighlight">10</td>
<td><pre class="srcLine">		return $this-&gt;getSet(Xyster_Collection::using($entities));</pre></td>
</tr>
<tr>
<td class="lineCount">706</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	}</pre></td>
</tr>
<tr>
<td class="lineCount">707</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">708</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	/**</pre></td>
</tr>
<tr>
<td class="lineCount">709</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * Gets the columns to select</pre></td>
</tr>
<tr>
<td class="lineCount">710</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 *</pre></td>
</tr>
<tr>
<td class="lineCount">711</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * @return array</pre></td>
</tr>
<tr>
<td class="lineCount">712</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 */</pre></td>
</tr>
<tr>
<td class="lineCount">713</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	protected function _selectColumns()</pre></td>
</tr>
<tr>
<td class="lineCount">714</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	{</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">715</td>
<td class="lineCountHighlight">16</td>
<td><pre class="srcLine">	    $columns = array();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">716</td>
<td class="lineCountHighlight">16</td>
<td><pre class="srcLine">		foreach( $this-&gt;getFields() as $name =&gt; $v ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">717</td>
<td class="lineCountHighlight">16</td>
<td><pre class="srcLine">			$alias = $this-&gt;translateField($name);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">718</td>
<td class="lineCountHighlight">16</td>
<td><pre class="srcLine">			$columns[$alias] = $name;</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">719</td>
<td class="lineCountHighlight">16</td>
<td><pre class="srcLine">		}</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">720</td>
<td class="lineCountHighlight">16</td>
<td><pre class="srcLine">		return $columns;</pre></td>
</tr>
<tr>
<td class="lineCount">721</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	}</pre></td>
</tr>
<tr>
<td class="lineCount">722</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">723</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    /**</pre></td>
</tr>
<tr>
<td class="lineCount">724</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @param mixed $metadataCache Either a Cache object, or a string naming a Registry key</pre></td>
</tr>
<tr>
<td class="lineCount">725</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @return Zend_Cache_Core</pre></td>
</tr>
<tr>
<td class="lineCount">726</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @throws Xyster_Orm_Mapper_Exception</pre></td>
</tr>
<tr>
<td class="lineCount">727</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     */</pre></td>
</tr>
<tr>
<td class="lineCount">728</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    protected final function _setupMetadataCache($metadataCache)</pre></td>
</tr>
<tr>
<td class="lineCount">729</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">730</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">        if (is_string($metadataCache)) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">731</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">            require_once 'Zend/Registry.php';</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">732</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">            $metadataCache = Zend_Registry::get($metadataCache);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">733</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCount">734</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">735</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">        if ($metadataCache === null || $metadataCache instanceof Zend_Cache_Core) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">736</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">            return $metadataCache;</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">737</td>
<td class="coverageCountHighlight">0</td>
<td><pre class="srcLineHighlight">        }</pre></td>
</tr>
<tr>
<td class="lineCount">738</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">739</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">        require_once 'Xyster/Orm/Mapper/Exception.php';</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">740</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">        throw new Xyster_Orm_Mapper_Exception('Argument must be of type Zend_Cache_Core, or a Registry key where a Zend_Cache_Core object is stored');</pre></td>
</tr>
<tr>
<td class="lineCount">741</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    }</pre></td>
</tr>
<tr>
<td class="lineCount">742</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">743</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	/**</pre></td>
</tr>
<tr>
<td class="lineCount">744</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * Updates the values of an entity in the backend</pre></td>
</tr>
<tr>
<td class="lineCount">745</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 *</pre></td>
</tr>
<tr>
<td class="lineCount">746</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 * @param Xyster_Orm_Entity $entity The entity to update</pre></td>
</tr>
<tr>
<td class="lineCount">747</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @throws Xyster_Orm_Mapper_Exception if the record was modified or deleted</pre></td>
</tr>
<tr>
<td class="lineCount">748</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	 */</pre></td>
</tr>
<tr>
<td class="lineCount">749</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	protected function _update( Xyster_Orm_Entity $entity )</pre></td>
</tr>
<tr>
<td class="lineCount">750</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	{</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">751</td>
<td class="lineCountHighlight">6</td>
<td><pre class="srcLine">	    $db = $this-&gt;_getAdapter();</pre></td>
</tr>
<tr>
<td class="lineCount">752</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">753</td>
<td class="lineCountHighlight">6</td>
<td><pre class="srcLine">    	$values = array();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">754</td>
<td class="lineCountHighlight">6</td>
<td><pre class="srcLine">    	foreach( $entity-&gt;getDirtyFields() as $name =&gt; $value ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">755</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">    	    $values[ $this-&gt;untranslateField($name) ] = $value;</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">756</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">    	}</pre></td>
</tr>
<tr>
<td class="lineCount">757</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">758</td>
<td class="lineCountHighlight">6</td>
<td><pre class="srcLine">	    $keyNames = $this-&gt;getEntityType()-&gt;getPrimary();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">759</td>
<td class="lineCountHighlight">6</td>
<td><pre class="srcLine">	    $key = $entity-&gt;getPrimaryKey(true);</pre></td>
</tr>
<tr>
<td class="lineCount">760</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">761</td>
<td class="lineCountHighlight">6</td>
<td><pre class="srcLine">	    $where = array();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">762</td>
<td class="lineCountHighlight">6</td>
<td><pre class="srcLine">	    foreach( $keyNames as $name ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">763</td>
<td class="lineCountHighlight">6</td>
<td><pre class="srcLine">	        $sql = $db-&gt;quoteIdentifier($this-&gt;untranslateField($name)) . ' = ?';</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">764</td>
<td class="lineCountHighlight">6</td>
<td><pre class="srcLine">	        $where[] = $db-&gt;quoteInto($sql, $key[$name]);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">765</td>
<td class="lineCountHighlight">6</td>
<td><pre class="srcLine">    	}</pre></td>
</tr>
<tr>
<td class="lineCount">766</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">767</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">        // optimistic locking</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">768</td>
<td class="lineCountHighlight">6</td>
<td><pre class="srcLine">    	$lockingField = $this-&gt;getOption('locking');</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">769</td>
<td class="lineCountHighlight">6</td>
<td><pre class="srcLine">    	$lockingVersion = 0;</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">770</td>
<td class="lineCountHighlight">6</td>
<td><pre class="srcLine">    	if ( $lockingField ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">771</td>
<td class="coverageCountHighlight">0</td>
<td><pre class="srcLineHighlight">    		$dbLockingField = $this-&gt;untranslateField($lockingField);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">772</td>
<td class="coverageCountHighlight">0</td>
<td><pre class="srcLineHighlight">    		$lockingVersion = $entity-&gt;$lockingField;</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">773</td>
<td class="coverageCountHighlight">0</td>
<td><pre class="srcLineHighlight">    		$sql = $db-&gt;quoteIdentifier($dbLockingField) . ' = ?';</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">774</td>
<td class="coverageCountHighlight">0</td>
<td><pre class="srcLineHighlight">            $where[] = $db-&gt;quoteInto($sql, $lockingVersion);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">775</td>
<td class="coverageCountHighlight">0</td>
<td><pre class="srcLineHighlight">            if ( count($values) &gt; 0 ) {</pre></td>
</tr>
<tr>
<td class="lineCount">776</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">            	// if we have dirty values, increase the version number</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">777</td>
<td class="coverageCountHighlight">0</td>
<td><pre class="srcLineHighlight">            	$values[$dbLockingField] = $entity-&gt;$lockingField++;</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">778</td>
<td class="coverageCountHighlight">0</td>
<td><pre class="srcLineHighlight">            }</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">779</td>
<td class="coverageCountHighlight">0</td>
<td><pre class="srcLineHighlight">    	}</pre></td>
</tr>
<tr>
<td class="lineCount">780</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">781</td>
<td class="lineCountHighlight">6</td>
<td><pre class="srcLine">    	if ( count($values) &gt; 0 ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">782</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">    	    $rows = $this-&gt;_getAdapter()-&gt;update($this-&gt;getTable(), $values, $where);</pre></td>
</tr>
<tr>
<td class="lineCount">783</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">784</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    	    // optimistic locking</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">785</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">    	    if ( $lockingField &amp;&amp; !$rows ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">786</td>
<td class="coverageCountHighlight">0</td>
<td><pre class="srcLineHighlight">    	    	require_once 'Xyster/Orm/Mapper/Exception.php';</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">787</td>
<td class="coverageCountHighlight">0</td>
<td><pre class="srcLineHighlight">   	    		throw new Xyster_Orm_Mapper_Exception("Could not update the '" .</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">788</td>
<td class="coverageCountHighlight">0</td>
<td><pre class="srcLineHighlight">   	    		  $this-&gt;getEntityName() . "' with ID '" .</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">789</td>
<td class="coverageCountHighlight">0</td>
<td><pre class="srcLineHighlight">   	    		  $entity-&gt;getPrimaryKeyAsString(true) . "' and version #" .</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">790</td>
<td class="coverageCountHighlight">0</td>
<td><pre class="srcLineHighlight">   	    		  $lockingVersion .</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">791</td>
<td class="coverageCountHighlight">0</td>
<td><pre class="srcLineHighlight">   	    		  ".  The database record was either deleted or modified.");</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">792</td>
<td class="coverageCountHighlight">0</td>
<td><pre class="srcLineHighlight">    	    }</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">793</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">    	}</pre></td>
</tr>
<tr>
<td class="lineCount">794</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">	}</pre></td>
</tr>
<tr>
<td class="lineCount">795</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">}</pre></td>
</tr>
</table>
<br><table width="100%">
<tr><td><hr noshade size="1"></td></tr>
<tr><td class="small">Report generated at 2008-05-19T16:58:23-05:00</td></tr>
</table>
</BODY>
</HTML>
