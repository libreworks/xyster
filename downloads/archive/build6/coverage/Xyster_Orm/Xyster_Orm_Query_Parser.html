<HTML>
<HEAD>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<LINK REL="stylesheet" TYPE="text/css" TITLE="Style" href="../stylesheet.css">
</HEAD>
<BODY>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td class="bannercell" rowspan="2"><a href="http://phing.info/"><img src="http://phing.info/images/phing.gif" alt="http://phing.info/" align="left" border="0"></a></td>
<td style="text-align:right"><h2>Source Code Coverage</h2></td>
</tr>
<tr><td style="text-align:right">Designed for use with <a href="http://pear.php.net/package/PHPUnit2">PHPUnit2</a>, <a href="http://www.xdebug.org/">Xdebug</a> and <a href="http://phing.info/">Phing</a>.</td></tr>
</table>
<hr size="1">
<table class="log" cellpadding="5" cellspacing="0" width="100%"><tr class="a">
<td class="small">Methods: 10</td>
<td class="small">LOC: 375</td>
<td class="small">Statements: 200</td>
</tr></table>
<br><table class="log" cellpadding="5" cellspacing="0" width="100%">
<tr>
<th width="100%">Source file</th>
<th>Statements</th>
<th>Methods</th>
<th width="250" colspan="2" nowrap>Total coverage</th>
</tr>
<tr class="a">
<td>Parser.php</td>
<td>97.0%</td>
<td>100.0%</td>
<td>97.1%</td>
<td><table cellspacing="0" cellpadding="0" border="0" width="100%" style="display: inline"><tr>
<td class="covered" width="194" height="12"> </td>
<td class="uncovered" width="6" height="12"> </td>
</tr></table></td>
</tr>
</table>
<table cellspacing="0" cellpadding="0" width="100%">
<tr>
<td class="lineCount">1</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">&lt;?php</pre></td>
</tr>
<tr>
<td class="lineCount">2</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">/**</pre></td>
</tr>
<tr>
<td class="lineCount">3</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * Xyster Framework</pre></td>
</tr>
<tr>
<td class="lineCount">4</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> *</pre></td>
</tr>
<tr>
<td class="lineCount">5</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * This source file is subject to the new BSD license that is bundled</pre></td>
</tr>
<tr>
<td class="lineCount">6</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * with this package in the file LICENSE.txt.</pre></td>
</tr>
<tr>
<td class="lineCount">7</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * It is also available through the world-wide-web at this URL:</pre></td>
</tr>
<tr>
<td class="lineCount">8</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * http://www.opensource.org/licenses/bsd-license.php</pre></td>
</tr>
<tr>
<td class="lineCount">9</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> *</pre></td>
</tr>
<tr>
<td class="lineCount">10</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * @category  Xyster</pre></td>
</tr>
<tr>
<td class="lineCount">11</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * @package   Xyster_Orm</pre></td>
</tr>
<tr>
<td class="lineCount">12</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * @copyright Copyright (c) 2007-2008 Irrational Logic (http://irrationallogic.net)</pre></td>
</tr>
<tr>
<td class="lineCount">13</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License</pre></td>
</tr>
<tr>
<td class="lineCount">14</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * @version   $Id: Parser.php 220 2008-02-09 18:04:52Z doublecompile $</pre></td>
</tr>
<tr>
<td class="lineCount">15</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> */</pre></td>
</tr>
<tr>
<td class="lineCount">16</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">/**</pre></td>
</tr>
<tr>
<td class="lineCount">17</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * @see Xyster_Orm_Xsql</pre></td>
</tr>
<tr>
<td class="lineCount">18</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> */</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">19</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">require_once 'Xyster/Orm/Xsql.php';</pre></td>
</tr>
<tr>
<td class="lineCount">20</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">/**</pre></td>
</tr>
<tr>
<td class="lineCount">21</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * Parses an XSQL string into a Xyster_Orm_Query object</pre></td>
</tr>
<tr>
<td class="lineCount">22</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> *</pre></td>
</tr>
<tr>
<td class="lineCount">23</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * @category  Xyster</pre></td>
</tr>
<tr>
<td class="lineCount">24</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * @package   Xyster_Orm</pre></td>
</tr>
<tr>
<td class="lineCount">25</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * @copyright Copyright (c) 2007-2008 Irrational Logic (http://irrationallogic.net)</pre></td>
</tr>
<tr>
<td class="lineCount">26</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> * @license   http://www.opensource.org/licenses/bsd-license.php New BSD License</pre></td>
</tr>
<tr>
<td class="lineCount">27</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"> */</pre></td>
</tr>
<tr>
<td class="lineCount">28</td>
<td class="coverageCount"></td>
<td class="srcLineClassStart"><pre class="srcLine">class Xyster_Orm_Query_Parser</pre></td>
</tr>
<tr>
<td class="lineCount">29</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">{</pre></td>
</tr>
<tr>
<td class="lineCount">30</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    /**</pre></td>
</tr>
<tr>
<td class="lineCount">31</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * Parse a statement into a Xyster_Data_Criterion</pre></td>
</tr>
<tr>
<td class="lineCount">32</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     *</pre></td>
</tr>
<tr>
<td class="lineCount">33</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @param string $statement</pre></td>
</tr>
<tr>
<td class="lineCount">34</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @return Xyster_Data_Criterion</pre></td>
</tr>
<tr>
<td class="lineCount">35</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     */</pre></td>
</tr>
<tr>
<td class="lineCount">36</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    public function parseCriterion( $statement )</pre></td>
</tr>
<tr>
<td class="lineCount">37</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">38</td>
<td class="lineCountHighlight">57</td>
<td><pre class="srcLine">        require_once 'Xyster/Data/Junction.php';</pre></td>
</tr>
<tr>
<td class="lineCount">39</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">40</td>
<td class="lineCountHighlight">57</td>
<td><pre class="srcLine">        $crit = null;</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">41</td>
<td class="lineCountHighlight">57</td>
<td><pre class="srcLine">        $statement = trim($statement);</pre></td>
</tr>
<tr>
<td class="lineCount">42</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">43</td>
<td class="lineCountHighlight">57</td>
<td><pre class="srcLine">        $groups = Xyster_Orm_Xsql::matchGroups($statement);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">44</td>
<td class="lineCountHighlight">57</td>
<td><pre class="srcLine">        if ( count($groups) == 1 &amp;&amp; strlen($groups[0]) == strlen($statement) ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">45</td>
<td class="lineCountHighlight">38</td>
<td><pre class="srcLine">            $statement = trim(substr($statement, 1, -1));</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">46</td>
<td class="lineCountHighlight">38</td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCount">47</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">48</td>
<td class="lineCountHighlight">57</td>
<td><pre class="srcLine">        $crits = Xyster_Orm_Xsql_Split::Custom(' AND ')-&gt;split($statement, true);</pre></td>
</tr>
<tr>
<td class="lineCount">49</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">        // in case it split the and of a "BETWEEN x AND y"</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">50</td>
<td class="lineCountHighlight">57</td>
<td><pre class="srcLine">        if ( count($crits) == 2 &amp;&amp; Xyster_Orm_Xsql::isLiteral($crits[1]) ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">51</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">            $crits = array($statement);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">52</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCount">53</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">54</td>
<td class="lineCountHighlight">57</td>
<td><pre class="srcLine">        if ( count($crits) &lt; 2 ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">55</td>
<td class="lineCountHighlight">57</td>
<td><pre class="srcLine">            $subcrits = Xyster_Orm_Xsql_Split::Custom(' OR ')-&gt;split($statement, true);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">56</td>
<td class="lineCountHighlight">57</td>
<td><pre class="srcLine">            if ( count($subcrits) &lt; 2 ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">57</td>
<td class="lineCountHighlight">57</td>
<td><pre class="srcLine">                $groups = Xyster_Orm_Xsql::matchGroups(trim($subcrits[0]));</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">58</td>
<td class="lineCountHighlight">57</td>
<td><pre class="srcLine">                $crit = ( count($groups) &gt; 0 &amp;&amp; strlen($groups[0]) ) ?</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">59</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">                    $this-&gt;parseCriterion($subcrits[0]) :</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">60</td>
<td class="lineCountHighlight">57</td>
<td><pre class="srcLine">                    $this-&gt;parseExpression($subcrits[0]);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">61</td>
<td class="lineCountHighlight">57</td>
<td><pre class="srcLine">            } else {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">62</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">                $criteria = array_map(array($this, 'parseCriterion'), $subcrits);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">63</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">                $crit = Xyster_Data_Criterion::fromArray('OR', $criteria);</pre></td>
</tr>
<tr>
<td class="lineCount">64</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">            }</pre></td>
</tr>
<tr>
<td class="lineCount">65</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">66</td>
<td class="lineCountHighlight">57</td>
<td><pre class="srcLine">        } else {</pre></td>
</tr>
<tr>
<td class="lineCount">67</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">68</td>
<td class="lineCountHighlight">5</td>
<td><pre class="srcLine">            $crit = Xyster_Data_Junction::all($this-&gt;parseCriterion($crits[0]),</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">69</td>
<td class="lineCountHighlight">5</td>
<td><pre class="srcLine">                $this-&gt;parseCriterion($crits[1]));</pre></td>
</tr>
<tr>
<td class="lineCount">70</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">71</td>
<td class="lineCountHighlight">5</td>
<td><pre class="srcLine">            if ( count($crits) &gt; 2 ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">72</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">                for ( $i=2; $i&lt;count($crits); $i++ ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">73</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">                    $crit-&gt;add($this-&gt;parseCriterion($crits[$i]));</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">74</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">                }</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">75</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">            }</pre></td>
</tr>
<tr>
<td class="lineCount">76</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCount">77</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">78</td>
<td class="lineCountHighlight">57</td>
<td><pre class="srcLine">        return $crit;</pre></td>
</tr>
<tr>
<td class="lineCount">79</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    }</pre></td>
</tr>
<tr>
<td class="lineCount">80</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">81</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    /**</pre></td>
</tr>
<tr>
<td class="lineCount">82</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * Parse string statement as Expression</pre></td>
</tr>
<tr>
<td class="lineCount">83</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     *</pre></td>
</tr>
<tr>
<td class="lineCount">84</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @param string $statement</pre></td>
</tr>
<tr>
<td class="lineCount">85</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @return Xyster_Data_Expression</pre></td>
</tr>
<tr>
<td class="lineCount">86</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @throws Xyster_Orm_Query_Parser_Exception if the expression syntax is incorrect</pre></td>
</tr>
<tr>
<td class="lineCount">87</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     */</pre></td>
</tr>
<tr>
<td class="lineCount">88</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    public function parseExpression( $statement )</pre></td>
</tr>
<tr>
<td class="lineCount">89</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">90</td>
<td class="lineCountHighlight">62</td>
<td><pre class="srcLine">        require_once 'Xyster/Data/Expression.php';</pre></td>
</tr>
<tr>
<td class="lineCount">91</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">92</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">        // remove whitespace characters we don't like</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">93</td>
<td class="lineCountHighlight">62</td>
<td><pre class="srcLine">        $statement = Xyster_Orm_Xsql::splitSpace(preg_replace("/[\t\n\r]+/", " ", trim($statement)));</pre></td>
</tr>
<tr>
<td class="lineCount">94</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">95</td>
<td class="lineCountHighlight">62</td>
<td><pre class="srcLine">        $exp = array();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">96</td>
<td class="lineCountHighlight">62</td>
<td><pre class="srcLine">        foreach( $statement as $v ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">97</td>
<td class="lineCountHighlight">62</td>
<td><pre class="srcLine">            if( $v != "" ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">98</td>
<td class="lineCountHighlight">62</td>
<td><pre class="srcLine">                $exp[] = $v;</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">99</td>
<td class="lineCountHighlight">62</td>
<td><pre class="srcLine">            }</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">100</td>
<td class="lineCountHighlight">62</td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCount">101</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">102</td>
<td class="lineCountHighlight">62</td>
<td><pre class="srcLine">        $leftlit = $this-&gt;parseField($exp[0]);</pre></td>
</tr>
<tr>
<td class="lineCount">103</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">104</td>
<td class="lineCountHighlight">62</td>
<td><pre class="srcLine">        array_shift($exp);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">105</td>
<td class="lineCountHighlight">62</td>
<td><pre class="srcLine">        $upper0 = strtoupper($exp[0]);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">106</td>
<td class="lineCountHighlight">62</td>
<td><pre class="srcLine">        $upper1 = strtoupper($exp[1]);</pre></td>
</tr>
<tr>
<td class="lineCount">107</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">108</td>
<td class="lineCountHighlight">62</td>
<td><pre class="srcLine">        if ( $upper0 == "NOT" || ( $upper0 == "IS" &amp;&amp; $upper1 == "NOT" ) ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">109</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">            $operator = $upper0 . " " . $upper1;</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">110</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">            array_shift($exp);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">111</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">        } else {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">112</td>
<td class="lineCountHighlight">61</td>
<td><pre class="srcLine">            $operator = $upper0;</pre></td>
</tr>
<tr>
<td class="lineCount">113</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCount">114</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">115</td>
<td class="lineCountHighlight">62</td>
<td><pre class="srcLine">        require_once 'Xyster/Enum.php';</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">116</td>
<td class="lineCountHighlight">62</td>
<td><pre class="srcLine">        if ( !in_array($operator, array_keys(Xyster_Enum::values('Xyster_Data_Operator_Expression'))) ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">117</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">            require_once 'Xyster/Orm/Query/Parser/Exception.php';</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">118</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">            throw new Xyster_Orm_Query_Parser_Exception('Invalid expression operator: ' . $operator);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">119</td>
<td class="coverageCountHighlight">0</td>
<td><pre class="srcLineHighlight">        }</pre></td>
</tr>
<tr>
<td class="lineCount">120</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">121</td>
<td class="lineCountHighlight">61</td>
<td><pre class="srcLine">        array_shift($exp);</pre></td>
</tr>
<tr>
<td class="lineCount">122</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">123</td>
<td class="lineCountHighlight">61</td>
<td><pre class="srcLine">        if ( ( $operator == "BETWEEN" || $operator == "NOT BETWEEN" ) &amp;&amp; count($exp) != 3 ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">124</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">            require_once 'Xyster/Orm/Query/Parser/Exception.php';</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">125</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">            throw new Xyster_Orm_Query_Parser_Exception('Invalid literal: ' . implode(" ",$exp));</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">126</td>
<td class="coverageCountHighlight">0</td>
<td><pre class="srcLineHighlight">        }</pre></td>
</tr>
<tr>
<td class="lineCount">127</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">128</td>
<td class="lineCountHighlight">60</td>
<td><pre class="srcLine">        if ( $operator == "IN" || $operator == "NOT IN" ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">129</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">            $rightlit = trim(implode(' ', $exp));</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">130</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">            $matches = array();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">131</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">            if ( !preg_match('/^\([\s]*(?P&lt;choices&gt;.*)[\s]*\)$/', $rightlit, $matches) ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">132</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">                require_once 'Xyster/Orm/Query/Parser/Exception.php';</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">133</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">                throw new Xyster_Orm_Query_Parser_Exception('Invalid literal: ' . $rightlit);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">134</td>
<td class="coverageCountHighlight">0</td>
<td><pre class="srcLineHighlight">            } else {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">135</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">            	$inChoices = Xyster_Orm_Xsql::splitComma($matches['choices']);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">136</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">                foreach( $inChoices as $k=&gt;$choice ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">137</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">                    $choice = trim($choice);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">138</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">                    $this-&gt;_checkLiteral($choice);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">139</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">                    if ( preg_match('/^"[^"]*"$/i', $choice) )</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">140</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">                        $inChoices[$k] = substr($choice, 1, -1);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">141</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">                }</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">142</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">                $rightlit = $inChoices;</pre></td>
</tr>
<tr>
<td class="lineCount">143</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">            }</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">144</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">        } else {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">145</td>
<td class="lineCountHighlight">58</td>
<td><pre class="srcLine">            $rightlit = ( $operator == "BETWEEN" || $operator == "NOT BETWEEN" ) ?</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">146</td>
<td class="lineCountHighlight">58</td>
<td><pre class="srcLine">                array( $exp[0], $exp[2] ) : $exp[0];</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">147</td>
<td class="lineCountHighlight">58</td>
<td><pre class="srcLine">            $this-&gt;_checkLiteral($rightlit);</pre></td>
</tr>
<tr>
<td class="lineCount">148</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCount">149</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">150</td>
<td class="lineCountHighlight">58</td>
<td><pre class="srcLine">        if ( !is_array($rightlit) &amp;&amp; preg_match('/^"[^"]*"$/i', $rightlit) ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">151</td>
<td class="lineCountHighlight">7</td>
<td><pre class="srcLine">            $rightlit = substr($rightlit, 1, -1);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">152</td>
<td class="lineCountHighlight">7</td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCount">153</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">154</td>
<td class="lineCountHighlight">58</td>
<td><pre class="srcLine">        $args = array( $leftlit );</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">155</td>
<td class="lineCountHighlight">58</td>
<td><pre class="srcLine">        if ( in_array($operator, array("=","&lt;&gt;","&gt;","&gt;=","&lt;","&lt;=","LIKE","NOT LIKE",'IN','NOT IN')) ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">156</td>
<td class="lineCountHighlight">58</td>
<td><pre class="srcLine">            $args[] = $rightlit;</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">157</td>
<td class="lineCountHighlight">58</td>
<td><pre class="srcLine">        } else if ( $operator == "BETWEEN" || $operator == "NOT BETWEEN" ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">158</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">            $args[] = $rightlit[0];</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">159</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">            $args[] = $rightlit[1];</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">160</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCount">161</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">162</td>
<td class="lineCountHighlight">58</td>
<td><pre class="srcLine">        return call_user_func_array(array("Xyster_Data_Expression",</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">163</td>
<td class="lineCountHighlight">58</td>
<td><pre class="srcLine">            Xyster_Data_Expression::getMethodName($operator)), $args);</pre></td>
</tr>
<tr>
<td class="lineCount">164</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    }</pre></td>
</tr>
<tr>
<td class="lineCount">165</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">166</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    /**</pre></td>
</tr>
<tr>
<td class="lineCount">167</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * Parse a string as Field</pre></td>
</tr>
<tr>
<td class="lineCount">168</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     *</pre></td>
</tr>
<tr>
<td class="lineCount">169</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @param string $name</pre></td>
</tr>
<tr>
<td class="lineCount">170</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @return Xyster_Data_Field</pre></td>
</tr>
<tr>
<td class="lineCount">171</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     */</pre></td>
</tr>
<tr>
<td class="lineCount">172</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    public function parseField( $name )</pre></td>
</tr>
<tr>
<td class="lineCount">173</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">174</td>
<td class="lineCountHighlight">65</td>
<td><pre class="srcLine">        $name = trim($name);</pre></td>
</tr>
<tr>
<td class="lineCount">175</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">176</td>
<td class="lineCountHighlight">65</td>
<td><pre class="srcLine">        require_once 'Xyster/Data/Field/Aggregate.php';</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">177</td>
<td class="lineCountHighlight">65</td>
<td><pre class="srcLine">        $match = Xyster_Data_Field_Aggregate::match($name);</pre></td>
</tr>
<tr>
<td class="lineCount">178</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">179</td>
<td class="lineCountHighlight">65</td>
<td><pre class="srcLine">        if ( $match ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">180</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">            require_once 'Xyster/Enum.php';</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">181</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">            $function = Xyster_Enum::valueOf('Xyster_Data_Aggregate', strtoupper($match['function']));</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">182</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">            $field = Xyster_Data_Field::aggregate($function, trim($match['field']));</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">183</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        } else {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">184</td>
<td class="lineCountHighlight">64</td>
<td><pre class="srcLine">            $field = Xyster_Data_Field::named($name);</pre></td>
</tr>
<tr>
<td class="lineCount">185</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCount">186</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">187</td>
<td class="lineCountHighlight">65</td>
<td><pre class="srcLine">        return $field;</pre></td>
</tr>
<tr>
<td class="lineCount">188</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    }</pre></td>
</tr>
<tr>
<td class="lineCount">189</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">190</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    /**</pre></td>
</tr>
<tr>
<td class="lineCount">191</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * Parse a string as Field with alias</pre></td>
</tr>
<tr>
<td class="lineCount">192</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     *</pre></td>
</tr>
<tr>
<td class="lineCount">193</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @param string $name</pre></td>
</tr>
<tr>
<td class="lineCount">194</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @return Xyster_Data_Field</pre></td>
</tr>
<tr>
<td class="lineCount">195</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     */</pre></td>
</tr>
<tr>
<td class="lineCount">196</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    public function parseFieldAlias( $statement )</pre></td>
</tr>
<tr>
<td class="lineCount">197</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">198</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        $statement = trim($statement);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">199</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        $matches = array();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">200</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        $alias = $statement;</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">201</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        $pattern = '/[\s]+(AS[\s]+(?P&lt;aliasA&gt;[a-z0-9_]+)|"(?P&lt;aliasQ&gt;[a-z0-9_]+)")/i';</pre></td>
</tr>
<tr>
<td class="lineCount">202</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">203</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        if (preg_match($pattern, $statement, $matches)) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">204</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">            if (!empty($matches['aliasA']) || !empty($matches['aliasQ'])) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">205</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">                $alias = (!empty($matches['aliasA'])) ?</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">206</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">                    $matches['aliasA'] : $matches['aliasQ'];</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">207</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">            }</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">208</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">            $statement = str_replace($matches[0], "", $statement);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">209</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCount">210</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">211</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        $field = $this-&gt;parseField($statement);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">212</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        $field-&gt;setAlias($alias);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">213</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        return $field;</pre></td>
</tr>
<tr>
<td class="lineCount">214</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    }</pre></td>
</tr>
<tr>
<td class="lineCount">215</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">216</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    /**</pre></td>
</tr>
<tr>
<td class="lineCount">217</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * Parses string statement as Xyster_Orm_Query</pre></td>
</tr>
<tr>
<td class="lineCount">218</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     *</pre></td>
</tr>
<tr>
<td class="lineCount">219</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @param Xyster_Orm_Query $query</pre></td>
</tr>
<tr>
<td class="lineCount">220</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @param string $statement</pre></td>
</tr>
<tr>
<td class="lineCount">221</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     */</pre></td>
</tr>
<tr>
<td class="lineCount">222</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    public function parseQuery( Xyster_Orm_Query $query, $statement )</pre></td>
</tr>
<tr>
<td class="lineCount">223</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">224</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">        $expecting = array('where', 'order');</pre></td>
</tr>
<tr>
<td class="lineCount">225</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">226</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">        $parts = $this-&gt;_baseParseQuery($query, $statement, $expecting);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">227</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">        if ( !empty($parts['where']) ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">228</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">            $query-&gt;where($this-&gt;parseCriterion($parts['where']));</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">229</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">230</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">        if ( !empty($parts['order']) ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">231</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">            $this-&gt;_parseClause($query, 'order', $parts['order']);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">232</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCount">233</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    }</pre></td>
</tr>
<tr>
<td class="lineCount">234</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">235</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    /**</pre></td>
</tr>
<tr>
<td class="lineCount">236</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * Parses string statement as Xyster_Orm_Query_Report</pre></td>
</tr>
<tr>
<td class="lineCount">237</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     *</pre></td>
</tr>
<tr>
<td class="lineCount">238</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @param Xyster_Orm_Query_Report $query</pre></td>
</tr>
<tr>
<td class="lineCount">239</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @param string $statement</pre></td>
</tr>
<tr>
<td class="lineCount">240</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     */</pre></td>
</tr>
<tr>
<td class="lineCount">241</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    public function parseReportQuery( Xyster_Orm_Query_Report $query, $statement )</pre></td>
</tr>
<tr>
<td class="lineCount">242</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">243</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        $expecting = array('select', 'where', 'group', 'having', 'order');</pre></td>
</tr>
<tr>
<td class="lineCount">244</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">245</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        $parts = $this-&gt;_baseParseQuery($query, $statement, $expecting);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">246</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        if ( empty($parts['select']) ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">247</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">            require_once 'Xyster/Orm/Query/Parser/Exception.php';</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">248</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">            throw new Xyster_Orm_Query_Parser_Exception('Invalid statement: ' . $statement);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">249</td>
<td class="coverageCountHighlight">0</td>
<td><pre class="srcLineHighlight">        }</pre></td>
</tr>
<tr>
<td class="lineCount">250</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">251</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">        $matches = array();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">252</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">        if (preg_match('/^distinct[[:space:]]+/i', $parts['select'], $matches)) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">253</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">            $query-&gt;distinct(true);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">254</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">            $parts['select'] = str_replace($matches[0], '', $parts['select']);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">255</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCount">256</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">257</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">        $this-&gt;_parseClause($query, 'select', $parts['select']);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">258</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">        if ( !empty($parts['where']) ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">259</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">            $query-&gt;where($this-&gt;parseCriterion($parts['where']));</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">260</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">261</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">        if ( !empty($parts['order']) ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">262</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">            $this-&gt;_parseClause($query, 'order', $parts['order']);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">263</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">264</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">        if ( !empty($parts['group']) ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">265</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">            $this-&gt;_parseClause($query, 'group', $parts['group']);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">266</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">267</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">        if ( !empty($parts['having']) ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">268</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">            $query-&gt;having($this-&gt;parseCriterion($parts['having']));</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">269</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCount">270</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    }</pre></td>
</tr>
<tr>
<td class="lineCount">271</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">272</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    /**</pre></td>
</tr>
<tr>
<td class="lineCount">273</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * Parse string statement as a {@link Xyster_Data_Sort}</pre></td>
</tr>
<tr>
<td class="lineCount">274</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     *</pre></td>
</tr>
<tr>
<td class="lineCount">275</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @param string $statement</pre></td>
</tr>
<tr>
<td class="lineCount">276</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @return Xyster_Data_Sort</pre></td>
</tr>
<tr>
<td class="lineCount">277</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @throws Xyster_Orm_Query_Parser_Exception  if the statement syntax is invalid</pre></td>
</tr>
<tr>
<td class="lineCount">278</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     */</pre></td>
</tr>
<tr>
<td class="lineCount">279</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    public function parseSort( $statement )</pre></td>
</tr>
<tr>
<td class="lineCount">280</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">281</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        $statement = trim($statement);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">282</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        $matches = array();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">283</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        $dir = 'ASC';</pre></td>
</tr>
<tr>
<td class="lineCount">284</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">285</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        if ( preg_match('/\s+(?P&lt;dir&gt;ASC|DESC)$/i', $statement, $matches) ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">286</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">            $dir = $matches["dir"];</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">287</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">            $statement = trim(str_replace($matches[0], "", $statement));</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">288</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCount">289</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">290</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        $field = $this-&gt;parseField($statement);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">291</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        return (!strcasecmp($dir, 'DESC')) ? $field-&gt;desc() : $field-&gt;asc();</pre></td>
</tr>
<tr>
<td class="lineCount">292</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    }</pre></td>
</tr>
<tr>
<td class="lineCount">293</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">294</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    /**</pre></td>
</tr>
<tr>
<td class="lineCount">295</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * Asserts a literal for syntactical correctness</pre></td>
</tr>
<tr>
<td class="lineCount">296</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     *</pre></td>
</tr>
<tr>
<td class="lineCount">297</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @param string $lit</pre></td>
</tr>
<tr>
<td class="lineCount">298</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @throws Xyster_Orm_Query_Parser_Exception if the syntax is incorrect</pre></td>
</tr>
<tr>
<td class="lineCount">299</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     */</pre></td>
</tr>
<tr>
<td class="lineCount">300</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    protected function _checkLiteral( $lit )</pre></td>
</tr>
<tr>
<td class="lineCount">301</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">302</td>
<td class="lineCountHighlight">59</td>
<td><pre class="srcLine">        if ( is_array($lit) ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">303</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">            foreach( $lit as $v ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">304</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">                $this-&gt;_checkLiteral($v);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">305</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">            }</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">306</td>
<td class="lineCountHighlight">59</td>
<td><pre class="srcLine">        } else if ( !Xyster_Orm_Xsql::isLiteral($lit) ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">307</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">            require_once 'Xyster/Orm/Query/Parser/Exception.php';</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">308</td>
<td class="lineCountHighlight">1</td>
<td><pre class="srcLine">            throw new Xyster_Orm_Query_Parser_Exception('Invalid literal: ' . $lit);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">309</td>
<td class="coverageCountHighlight">0</td>
<td><pre class="srcLineHighlight">        }</pre></td>
</tr>
<tr>
<td class="lineCount">310</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    }</pre></td>
</tr>
<tr>
<td class="lineCount">311</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">312</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    /**</pre></td>
</tr>
<tr>
<td class="lineCount">313</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * Removes the limit and offset clause from a statement</pre></td>
</tr>
<tr>
<td class="lineCount">314</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     *</pre></td>
</tr>
<tr>
<td class="lineCount">315</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @param Xyster_Orm_Query $query  The query into which the parts are set</pre></td>
</tr>
<tr>
<td class="lineCount">316</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @param string $statement  The statement to parse</pre></td>
</tr>
<tr>
<td class="lineCount">317</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @param array $expecting</pre></td>
</tr>
<tr>
<td class="lineCount">318</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @return array  The statement split by parts</pre></td>
</tr>
<tr>
<td class="lineCount">319</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     */</pre></td>
</tr>
<tr>
<td class="lineCount">320</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    protected function _baseParseQuery( Xyster_Orm_Query $query, $statement, array $expecting )</pre></td>
</tr>
<tr>
<td class="lineCount">321</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">322</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">        $matches = array();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">323</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">        if ( preg_match('/[\s]*LIMIT (?P&lt;limit&gt;[\d]+)( OFFSET (?P&lt;offset&gt;[\d]+))?$/i',$statement,$matches) ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">324</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">            $statement = str_replace($matches[0], '', $statement);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">325</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">326</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">        $limit = ( isset($matches['limit']) ) ? $matches['limit'] : 0;</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">327</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">        $offset = ( isset($matches['offset']) ) ? $matches['offset'] : 0;</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">328</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">        if ( $limit ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">329</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">            $query-&gt;limit($limit, $offset);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">330</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCount">331</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">332</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">        $parts = array();</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">333</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">        $part = '';</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">334</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">        $split = Xyster_Orm_Xsql::splitSpace(trim($statement));</pre></td>
</tr>
<tr>
<td class="lineCount">335</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">336</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">        foreach( $split as $v ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">337</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">            if ( in_array($part, array('order','group')) &amp;&amp; !strcasecmp($v, 'by') ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">338</td>
<td class="lineCountHighlight">2</td>
<td><pre class="srcLine">                continue;</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">339</td>
<td class="coverageCountHighlight">0</td>
<td><pre class="srcLineHighlight">            }</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">340</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">            foreach( $expecting as $epart ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">341</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">                if ( !strcasecmp($v, $epart) ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">342</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">                    $part = strtolower($v);</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">343</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">                }</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">344</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">            }</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">345</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">            if ( !in_array(strtolower($v), $expecting) ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">346</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">                if ( !isset($parts[$part]) ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">347</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">                    $parts[$part] = "";</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">348</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">                }</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">349</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">                $parts[$part] .= $v . " ";</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">350</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">            }</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">351</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCount">352</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCountHighlight">353</td>
<td class="lineCountHighlight">4</td>
<td><pre class="srcLine">        return $parts;</pre></td>
</tr>
<tr>
<td class="lineCount">354</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    }</pre></td>
</tr>
<tr>
<td class="lineCount">355</td>
<td class="coverageCount"></td>
<td><pre class="srcLine"></pre></td>
</tr>
<tr>
<td class="lineCount">356</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    /**</pre></td>
</tr>
<tr>
<td class="lineCount">357</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * Parses a string statement clause into its corresponding parts</pre></td>
</tr>
<tr>
<td class="lineCount">358</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     *</pre></td>
</tr>
<tr>
<td class="lineCount">359</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @param Xyster_Orm_Query $query The query into which the parts will be set</pre></td>
</tr>
<tr>
<td class="lineCount">360</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @param string $type  The type of clause (either select, group, or order)</pre></td>
</tr>
<tr>
<td class="lineCount">361</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     * @param string $statement  The actual clause to parse</pre></td>
</tr>
<tr>
<td class="lineCount">362</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">     */</pre></td>
</tr>
<tr>
<td class="lineCount">363</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    protected function _parseClause( Xyster_Orm_Query $query, $type, $statement )</pre></td>
</tr>
<tr>
<td class="lineCount">364</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    {</pre></td>
</tr>
<tr>
<td class="lineCount">365</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">        $call = array(</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">366</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">                'select'=&gt;array($this, 'parseFieldAlias'),</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">367</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">                'order'=&gt;array($this, 'parseSort'),</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">368</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">                'group'=&gt;array('Xyster_Data_Field', 'group')</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">369</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">            );</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">370</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        $method = array('select'=&gt;'field', 'order'=&gt;'order', 'group'=&gt;'group');</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">371</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        foreach( Xyster_Orm_Xsql::splitComma($statement) as $item ) {</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">372</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">            $query-&gt;{$method[$type]}( call_user_func($call[$type], $item) );</pre></td>
</tr>
<tr>
<td class="lineCountHighlight">373</td>
<td class="lineCountHighlight">3</td>
<td><pre class="srcLine">        }</pre></td>
</tr>
<tr>
<td class="lineCount">374</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">    }</pre></td>
</tr>
<tr>
<td class="lineCount">375</td>
<td class="coverageCount"></td>
<td><pre class="srcLine">}</pre></td>
</tr>
</table>
<br><table width="100%">
<tr><td><hr noshade size="1"></td></tr>
<tr><td class="small">Report generated at 2008-05-19T16:58:24-05:00</td></tr>
</table>
</BODY>
</HTML>
